import{Q as t,R as e,p as r,b as n,c as i,d as o,e as a,S as s,U as l,W as c,X as u,o as h,Y as p,Z as d,m as f,_ as g,D as T,T as y,$ as v,a0 as m,a1 as x,J as R,k as E,a2 as C,a3 as w,x as _,a4 as P,a5 as O,q as b,a6 as F,a7 as L}from"./TileProperty.6da85ab0.js";var S,U=(S=function(t,e){return(S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}S(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),A=function(p){function d(e){var r=p.call(this,e)||this;return r.container=null,r.renderedResolution,r.tempTransform=t(),r.pixelTransform=t(),r.inversePixelTransform=t(),r.context=null,r.containerReused=!1,r}return U(d,p),d.prototype.useContainer=function(t,n,i){var o,a,s=this.getLayer().getClassName();t&&t.style.opacity===e(i)&&t.className===s&&((c=t.firstElementChild)instanceof HTMLCanvasElement&&(a=c.getContext("2d")));if(a&&a.canvas.style.transform===n?(this.container=t,this.context=a,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){(o=document.createElement("div")).className=s;var l=o.style;l.position="absolute",l.width="100%",l.height="100%";var c=(a=r()).canvas;o.appendChild(c),(l=c.style).position="absolute",l.left="0",l.transformOrigin="top left",this.container=o,this.context=a}},d.prototype.clipUnrotated=function(t,e,r){var l=n(r),c=i(r),u=o(r),h=a(r);s(e.coordinateToPixelTransform,l),s(e.coordinateToPixelTransform,c),s(e.coordinateToPixelTransform,u),s(e.coordinateToPixelTransform,h);var p=this.inversePixelTransform;s(p,l),s(p,c),s(p,u),s(p,h),t.save(),t.beginPath(),t.moveTo(Math.round(l[0]),Math.round(l[1])),t.lineTo(Math.round(c[0]),Math.round(c[1])),t.lineTo(Math.round(u[0]),Math.round(u[1])),t.lineTo(Math.round(h[0]),Math.round(h[1])),t.clip()},d.prototype.dispatchRenderEvent_=function(t,e,r){var n=this.getLayer();if(n.hasListener(t)){var i=new l(t,this.inversePixelTransform,r,e);n.dispatchEvent(i)}},d.prototype.preRender=function(t,e){this.dispatchRenderEvent_(c.PRERENDER,t,e)},d.prototype.postRender=function(t,e){this.dispatchRenderEvent_(c.POSTRENDER,t,e)},d.prototype.getRenderTransform=function(t,e,r,n,i,o,a){var s=i/2,l=o/2,c=n/e,h=-c,p=-t[0]+a,d=-t[1];return u(this.tempTransform,s,l,c,h,-r,p,d)},d.prototype.getDataAtPixel=function(t,e,r){var n,i=s(this.inversePixelTransform,t.slice()),o=this.context,a=this.getLayer().getExtent();if(a){var l=s(e.pixelToCoordinateTransform,t.slice());if(!h(a,l))return null}try{var c=Math.round(i[0]),u=Math.round(i[1]),p=document.createElement("canvas"),d=p.getContext("2d");p.width=1,p.height=1,d.clearRect(0,0,1,1),d.drawImage(o.canvas,c,u,1,1,0,0,1,1),n=d.getImageData(0,0,1,1).data}catch(f){return"SecurityError"===f.name?new Uint8Array:n}return 0===n[3]?null:n},d}(p);function D(t,e){var r=/\{z\}/g,n=/\{x\}/g,i=/\{y\}/g,o=/\{-y\}/g;return function(a,s,l){return a?t.replace(r,a[0].toString()).replace(n,a[1].toString()).replace(i,a[2].toString()).replace(o,(function(){var t=a[0],r=e.getFullTileRange(t);return g(r,55),(r.getHeight()-a[2]-1).toString()})):void 0}}function j(t){return 1===t.length?t[0]:function(e,r,n){if(e){var i=d(e),o=f(i,t.length);return t[o](e,r,n)}}}var M=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),I=function(t){function e(r){var n=t.call(this,{attributions:r.attributions,cacheSize:r.cacheSize,opaque:r.opaque,projection:r.projection,state:r.state,tileGrid:r.tileGrid,tilePixelRatio:r.tilePixelRatio,wrapX:r.wrapX,transition:r.transition,key:r.key,attributionsCollapsible:r.attributionsCollapsible,zDirection:r.zDirection})||this;return n.generateTileUrlFunction_=n.tileUrlFunction===e.prototype.tileUrlFunction,n.tileLoadFunction=r.tileLoadFunction,r.tileUrlFunction&&(n.tileUrlFunction=r.tileUrlFunction),n.urls=null,r.urls?n.setUrls(r.urls):r.url&&n.setUrl(r.url),n.tileLoadingKeys_={},n}return M(e,t),e.prototype.getTileLoadFunction=function(){return this.tileLoadFunction},e.prototype.getTileUrlFunction=function(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction},e.prototype.getUrls=function(){return this.urls},e.prototype.handleTileChange=function(t){var e,r=t.target,n=T(r),i=r.getState();i==y.LOADING?(this.tileLoadingKeys_[n]=!0,e=x.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],e=i==y.ERROR?x.TILELOADERROR:i==y.LOADED?x.TILELOADEND:void 0),null!=e&&this.dispatchEvent(new v(e,r))},e.prototype.setTileLoadFunction=function(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()},e.prototype.setTileUrlFunction=function(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),void 0!==e?this.setKey(e):this.changed()},e.prototype.setUrl=function(t){var e=function(t){var e=[],r=/\{([a-z])-([a-z])\}/.exec(t);if(r){var n=r[1].charCodeAt(0),i=r[2].charCodeAt(0),o=void 0;for(o=n;o<=i;++o)e.push(t.replace(r[0],String.fromCharCode(o)));return e}if(r=/\{(\d+)-(\d+)\}/.exec(t)){for(var a=parseInt(r[2],10),s=parseInt(r[1],10);s<=a;s++)e.push(t.replace(r[0],s.toString()));return e}return e.push(t),e}(t);this.urls=e,this.setUrls(e)},e.prototype.setUrls=function(t){this.urls=t;var e=t.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(function(t,e){for(var r=t.length,n=new Array(r),i=0;i<r;++i)n[i]=D(t[i],e);return j(n)}(t,this.tileGrid),e):this.setKey(e)},e.prototype.tileUrlFunction=function(t,e,r){},e.prototype.useTile=function(t,e,r){var n=R(t,e,r);this.tileCache.containsKey(n)&&this.tileCache.get(n)},e}(m),z=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),K=function(t){function r(e){var r=t.call(this,e)||this;return r.extentChanged=!0,r.renderedExtent_=null,r.renderedPixelRatio,r.renderedProjection=null,r.renderedRevision,r.renderedTiles=[],r.newTiles_=!1,r.tmpExtent=E(),r.tmpTileRange_=new C(0,0,0,0),r}return z(r,t),r.prototype.isDrawableTile=function(t){var e=this.getLayer(),r=t.getState(),n=e.getUseInterimTilesOnError();return r==y.LOADED||r==y.EMPTY||r==y.ERROR&&!n},r.prototype.getTile=function(t,e,r,n){var i=n.pixelRatio,o=n.viewState.projection,a=this.getLayer(),s=a.getSource().getTile(t,e,r,i,o);return s.getState()==y.ERROR&&(a.getUseInterimTilesOnError()?a.getPreload()>0&&(this.newTiles_=!0):s.setState(y.LOADED)),this.isDrawableTile(s)||(s=s.getInterimTile()),s},r.prototype.loadedTileCallback=function(e,r,n){return!!this.isDrawableTile(n)&&t.prototype.loadedTileCallback.call(this,e,r,n)},r.prototype.prepareFrame=function(t){return!!this.getLayer().getSource()},r.prototype.renderFrame=function(t,r){var i=t.layerStatesArray[t.layerIndex],o=t.viewState,a=o.projection,l=o.resolution,c=o.center,h=o.rotation,p=t.pixelRatio,d=this.getLayer(),f=d.getSource(),g=f.getRevision(),v=f.getTileGridForProjection(a),m=v.getZForResolution(l,f.zDirection),x=v.getResolution(m),R=t.extent,E=i.extent&&w(i.extent);E&&(R=_(R,w(i.extent)));var C=f.getTilePixelRatio(p),S=Math.round(t.size[0]*C),U=Math.round(t.size[1]*C);if(h){var A=Math.round(Math.sqrt(S*S+U*U));S=A,U=A}var D=x*S/2/C,j=x*U/2/C,M=[c[0]-D,c[1]-j,c[0]+D,c[1]+j],I=v.getTileRangeForExtentAndZ(R,m),z={};z[m]={};var K=this.createLoadedTileFinder(f,a,z),N=this.tmpExtent,X=this.tmpTileRange_;this.newTiles_=!1;for(var Z=I.minX;Z<=I.maxX;++Z)for(var k=I.minY;k<=I.maxY;++k){var q=this.getTile(m,Z,k,t);if(this.isDrawableTile(q)){var G=T(this);if(q.getState()==y.LOADED){z[m][q.tileCoord.toString()]=q;var Y=q.inTransition(G);this.newTiles_||!Y&&-1!==this.renderedTiles.indexOf(q)||(this.newTiles_=!0)}if(1===q.getAlpha(G,t.time))continue}var Q=v.getTileCoordChildTileRange(q.tileCoord,X,N),H=!1;Q&&(H=K(m+1,Q)),H||v.forEachTileCoordParentTileRange(q.tileCoord,K,X,N)}var J=x/l;u(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/C,1/C,h,-S/2,-U/2);var W=P(this.pixelTransform);this.useContainer(r,W,i.opacity);var $=this.context,B=$.canvas;O(this.inversePixelTransform,this.pixelTransform),u(this.tempTransform,S/2,U/2,J,J,0,-S/2,-U/2),B.width!=S||B.height!=U?(B.width=S,B.height=U):this.containerReused||$.clearRect(0,0,S,U),E&&this.clipUnrotated($,t,E),b($,f.getContextOptions()),this.preRender($,t),this.renderedTiles.length=0;var V,tt,et,rt=Object.keys(z).map(Number);rt.sort(F),1!==i.opacity||this.containerReused&&!f.getOpaque(t.viewState.projection)?(V=[],tt=[]):rt=rt.reverse();for(var nt=rt.length-1;nt>=0;--nt){var it=rt[nt],ot=f.getTilePixelSize(it,p,a),at=v.getResolution(it)/x,st=ot[0]*at*J,lt=ot[1]*at*J,ct=v.getTileCoordForCoordAndZ(n(M),it),ut=v.getTileCoordExtent(ct),ht=s(this.tempTransform,[C*(ut[0]-M[0])/x,C*(M[3]-ut[3])/x]),pt=C*f.getGutterForProjection(a),dt=z[it];for(var ft in dt){var gt=(q=dt[ft]).tileCoord,Tt=ct[1]-gt[1],yt=Math.round(ht[0]-(Tt-1)*st),vt=ct[2]-gt[2],mt=Math.round(ht[1]-(vt-1)*lt),xt=yt-(Z=Math.round(ht[0]-Tt*st)),Rt=mt-(k=Math.round(ht[1]-vt*lt)),Et=m===it;if(!(Y=Et&&1!==q.getAlpha(T(this),t.time)))if(V){$.save(),et=[Z,k,Z+xt,k,Z+xt,k+Rt,Z,k+Rt];for(var Ct=0,wt=V.length;Ct<wt;++Ct)if(m!==it&&it<tt[Ct]){var _t=V[Ct];$.beginPath(),$.moveTo(et[0],et[1]),$.lineTo(et[2],et[3]),$.lineTo(et[4],et[5]),$.lineTo(et[6],et[7]),$.moveTo(_t[6],_t[7]),$.lineTo(_t[4],_t[5]),$.lineTo(_t[2],_t[3]),$.lineTo(_t[0],_t[1]),$.clip()}V.push(et),tt.push(it)}else $.clearRect(Z,k,xt,Rt);this.drawTileImage(q,t,Z,k,xt,Rt,pt,Et),V&&!Y?($.restore(),this.renderedTiles.unshift(q)):this.renderedTiles.push(q),this.updateUsedTiles(t.usedTiles,f,q)}}this.renderedRevision=g,this.renderedResolution=x,this.extentChanged=!this.renderedExtent_||!L(this.renderedExtent_,M),this.renderedExtent_=M,this.renderedPixelRatio=p,this.renderedProjection=a,this.manageTilePyramid(t,f,v,p,a,R,m,d.getPreload()),this.scheduleExpireCache(t,f),this.postRender($,t),i.extent&&$.restore(),W!==B.style.transform&&(B.style.transform=W);var Pt=e(i.opacity),Ot=this.container;return Pt!==Ot.style.opacity&&(Ot.style.opacity=Pt),this.container},r.prototype.drawTileImage=function(t,e,r,n,i,o,a,s){var l=this.getTileImage(t);if(l){var c=T(this),u=s?t.getAlpha(c,e.time):1,h=u!==this.context.globalAlpha;h&&(this.context.save(),this.context.globalAlpha=u),this.context.drawImage(l,a,a,l.width-2*a,l.height-2*a,r,n,i,o),h&&this.context.restore(),1!==u?e.animate=!0:s&&t.endTransition(c)}},r.prototype.getImage=function(){var t=this.context;return t?t.canvas:null},r.prototype.getTileImage=function(t){return t.getImage()},r.prototype.scheduleExpireCache=function(t,e){if(e.canExpireCache()){var r=function(t,e,r){var n=T(t);n in r.usedTiles&&t.expireCache(r.viewState.projection,r.usedTiles[n])}.bind(null,e);t.postRenderFunctions.push(r)}},r.prototype.updateUsedTiles=function(t,e,r){var n=T(e);n in t||(t[n]={}),t[n][r.getKey()]=!0},r.prototype.manageTilePyramid=function(t,e,r,n,i,o,a,s,l){var c=T(e);c in t.wantedTiles||(t.wantedTiles[c]={});var u,h,p,d,f,g,v=t.wantedTiles[c],m=t.tileQueue,x=0;for(g=r.getMinZoom();g<=a;++g)for(h=r.getTileRangeForExtentAndZ(o,g,h),p=r.getResolution(g),d=h.minX;d<=h.maxX;++d)for(f=h.minY;f<=h.maxY;++f)a-g<=s?(++x,(u=e.getTile(g,d,f,n,i)).getState()==y.IDLE&&(v[u.getKey()]=!0,m.isKeyQueued(u.getKey())||m.enqueue([u,c,r.getTileCoordCenter(u.tileCoord),p])),void 0!==l&&l(u)):e.useTile(g,d,f,i);e.updateCacheSize(x,i)},r}(A);K.prototype.getLayer;var N=K;export{N as C,I as U,A as a,j as c};
