import{l as t,i as e,M as r,L as i,a as o,b as n,t as s,F as a}from"./Feature.635c9857.js";import{b as u,H as l,c as h,h as p,r as d,R as f,C as c,d as g,g as y,B as v,l as T}from"./featureloader.82820175.js";import{a9 as _,aa as w,ab as x,v as F,ac as S,ad as C,ae as m,I as R,s as E,X as b,af as O,Q as I,ag as P,ah as M,_ as L,ai as G,aj as N,ak as V,al as D,T as A,am as j,D as B,h as k,an as U,S as X,ao as z,ap as Y,b as K,aq as Z,ar as H,as as W,at as q,au as J,x as Q,a7 as $,i as tt,q as et,O as rt,A as it,p as ot,L as nt,K as st,G as at,av as ut,aw as lt,E as ht,ax as pt,ay as dt,J as ft}from"./TileProperty.6da85ab0.js";import{C as ct,U as gt}from"./TileLayer.24fccdef.js";var yt={
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
read:function(t,e,r,i,o){var n,s,a=8*o-i-1,u=(1<<a)-1,l=u>>1,h=-7,p=r?o-1:0,d=r?-1:1,f=t[e+p];for(p+=d,n=f&(1<<-h)-1,f>>=-h,h+=a;h>0;n=256*n+t[e+p],p+=d,h-=8);for(s=n&(1<<-h)-1,n>>=-h,h+=i;h>0;s=256*s+t[e+p],p+=d,h-=8);if(0===n)n=1-l;else{if(n===u)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,i),n-=l}return(f?-1:1)*s*Math.pow(2,n-i)},write:function(t,e,r,i,o,n){var s,a,u,l=8*n-o-1,h=(1<<l)-1,p=h>>1,d=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:n-1,c=i?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=h):(s=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-s))<1&&(s--,u*=2),(e+=s+p>=1?d/u:d*Math.pow(2,1-p))*u>=2&&(s++,u/=2),s+p>=h?(a=0,s=h):s+p>=1?(a=(e*u-1)*Math.pow(2,o),s+=p):(a=e*Math.pow(2,p-1)*Math.pow(2,o),s=0));o>=8;t[r+f]=255&a,f+=c,a/=256,o-=8);for(s=s<<o|a,l+=o;l>0;t[r+f]=255&s,f+=c,s/=256,l-=8);t[r+f-c]|=128*g}},vt=_t,Tt=yt;function _t(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}_t.Varint=0,_t.Fixed64=1,_t.Bytes=2,_t.Fixed32=5;var wt="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function xt(t){return t.type===_t.Bytes?t.readVarint()+t.pos:t.pos+1}function Ft(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function St(t,e,r){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(i);for(var o=r.pos-1;o>=t;o--)r.buf[o+i]=r.buf[o]}function Ct(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function mt(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function Rt(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function Et(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function bt(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function Ot(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function It(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function Pt(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function Mt(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function Lt(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Gt(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function Nt(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}_t.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),o=i>>3,n=this.pos;this.type=7&i,t(o,e,this),this.pos===n&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Lt(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Nt(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Lt(this.buf,this.pos)+4294967296*Lt(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=Lt(this.buf,this.pos)+4294967296*Nt(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Tt.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Tt.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,i=this.buf;return e=127&(r=i[this.pos++]),r<128?e:(e|=(127&(r=i[this.pos++]))<<7,r<128?e:(e|=(127&(r=i[this.pos++]))<<14,r<128?e:(e|=(127&(r=i[this.pos++]))<<21,r<128?e:function(t,e,r){var i,o,n=r.buf;if(o=n[r.pos++],i=(112&o)>>4,o<128)return Ft(t,i,e);if(o=n[r.pos++],i|=(127&o)<<3,o<128)return Ft(t,i,e);if(o=n[r.pos++],i|=(127&o)<<10,o<128)return Ft(t,i,e);if(o=n[r.pos++],i|=(127&o)<<17,o<128)return Ft(t,i,e);if(o=n[r.pos++],i|=(127&o)<<24,o<128)return Ft(t,i,e);if(o=n[r.pos++],i|=(1&o)<<31,o<128)return Ft(t,i,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&wt?function(t,e,r){return wt.decode(t.subarray(e,r))}(this.buf,e,t):function(t,e,r){var i="",o=e;for(;o<r;){var n,s,a,u=t[o],l=null,h=u>239?4:u>223?3:u>191?2:1;if(o+h>r)break;1===h?u<128&&(l=u):2===h?128==(192&(n=t[o+1]))&&(l=(31&u)<<6|63&n)<=127&&(l=null):3===h?(n=t[o+1],s=t[o+2],128==(192&n)&&128==(192&s)&&((l=(15&u)<<12|(63&n)<<6|63&s)<=2047||l>=55296&&l<=57343)&&(l=null)):4===h&&(n=t[o+1],s=t[o+2],a=t[o+3],128==(192&n)&&128==(192&s)&&128==(192&a)&&((l=(15&u)<<18|(63&n)<<12|(63&s)<<6|63&a)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,h=1):l>65535&&(l-=65536,i+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),i+=String.fromCharCode(l),o+=h}return i}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==_t.Bytes)return t.push(this.readVarint(e));var r=xt(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==_t.Bytes)return t.push(this.readSVarint());var e=xt(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==_t.Bytes)return t.push(this.readBoolean());var e=xt(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==_t.Bytes)return t.push(this.readFloat());var e=xt(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==_t.Bytes)return t.push(this.readDouble());var e=xt(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==_t.Bytes)return t.push(this.readFixed32());var e=xt(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==_t.Bytes)return t.push(this.readSFixed32());var e=xt(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==_t.Bytes)return t.push(this.readFixed64());var e=xt(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==_t.Bytes)return t.push(this.readSFixed64());var e=xt(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===_t.Varint)for(;this.buf[this.pos++]>127;);else if(e===_t.Bytes)this.pos=this.readVarint()+this.pos;else if(e===_t.Fixed32)this.pos+=4;else{if(e!==_t.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Gt(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Gt(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Gt(this.buf,-1&t,this.pos),Gt(this.buf,Math.floor(2.3283064365386963e-10*t),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Gt(this.buf,-1&t,this.pos),Gt(this.buf,Math.floor(2.3283064365386963e-10*t),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var r,i;t>=0?(r=t%4294967296|0,i=t/4294967296|0):(i=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,i=i+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos]=127&t}(r,0,e),function(t,e){var r=(7&t)<<4;if(e.buf[e.pos++]|=r|((t>>>=3)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;e.buf[e.pos++]=127&t}(i,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var i,o,n=0;n<e.length;n++){if((i=e.charCodeAt(n))>55295&&i<57344){if(!o){i>56319||n+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):o=i;continue}if(i<56320){t[r++]=239,t[r++]=191,t[r++]=189,o=i;continue}i=o-55296<<10|i-56320|65536,o=null}else o&&(t[r++]=239,t[r++]=191,t[r++]=189,o=null);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:(i<65536?t[r++]=i>>12|224:(t[r++]=i>>18|240,t[r++]=i>>12&63|128),t[r++]=i>>6&63|128),t[r++]=63&i|128)}return r}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&St(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),Tt.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Tt.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var i=this.pos-r;i>=128&&St(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,r){this.writeTag(t,_t.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Ct,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,mt,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,bt,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Rt,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Et,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Ot,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,It,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Pt,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Mt,e)},writeBytesField:function(t,e){this.writeTag(t,_t.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,_t.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,_t.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,_t.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,_t.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,_t.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,_t.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,_t.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,_t.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,_t.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var Vt=I(),Dt=function(){function r(t,e,r,i,o){this.extent_,this.id_=o,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=r,this.properties_=i}return r.prototype.get=function(t){return this.properties_[t]},r.prototype.getExtent=function(){return this.extent_||(this.extent_=this.type_===_.POINT?w(this.flatCoordinates_):x(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_},r.prototype.getFlatInteriorPoint=function(){if(!this.flatInteriorPoints_){var t=F(this.getExtent());this.flatInteriorPoints_=S(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_},r.prototype.getFlatInteriorPoints=function(){if(!this.flatInteriorPoints_){var e=t(this.flatCoordinates_,0,this.ends_,2);this.flatInteriorPoints_=C(this.flatCoordinates_,0,this.ends_,2,e)}return this.flatInteriorPoints_},r.prototype.getFlatMidpoint=function(){return this.flatMidpoints_||(this.flatMidpoints_=e(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_},r.prototype.getFlatMidpoints=function(){if(!this.flatMidpoints_){this.flatMidpoints_=[];for(var t=this.flatCoordinates_,r=0,i=this.ends_,o=0,n=i.length;o<n;++o){var s=i[o],a=e(t,r,s,2,.5);m(this.flatMidpoints_,a),r=s}}return this.flatMidpoints_},r.prototype.getId=function(){return this.id_},r.prototype.getOrientedFlatCoordinates=function(){return this.flatCoordinates_},r.prototype.getGeometry=function(){return this},r.prototype.getSimplifiedGeometry=function(t){return this},r.prototype.simplifyTransformed=function(t,e){return this},r.prototype.getProperties=function(){return this.properties_},r.prototype.getStride=function(){return 2},r.prototype.getStyleFunction=function(){},r.prototype.getType=function(){return this.type_},r.prototype.transform=function(t){var e=(t=R(t)).getExtent(),r=t.getWorldExtent();if(e&&r){var i=E(r)/E(e);b(Vt,r[0],r[3],i,-i,0,0,0),O(this.flatCoordinates_,0,this.flatCoordinates_.length,2,Vt,this.flatCoordinates_)}},r.prototype.getEnds=function(){return this.ends_},r}();Dt.prototype.getEndss=Dt.prototype.getEnds,Dt.prototype.getFlatCoordinates=Dt.prototype.getOrientedFlatCoordinates;var At,jt=Dt,Bt=(At=function(t,e){return(At=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}At(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});function kt(t,e,r){if(3===t){var i={keys:[],values:[],features:[]},o=r.readVarint()+r.pos;r.readFields(Ut,i,o),i.length=i.features.length,i.length&&(e[i.name]=i)}}function Ut(t,e,r){if(15===t)e.version=r.readVarint();else if(1===t)e.name=r.readString();else if(5===t)e.extent=r.readVarint();else if(2===t)e.features.push(r.pos);else if(3===t)e.keys.push(r.readString());else if(4===t){for(var i=null,o=r.readVarint()+r.pos;r.pos<o;)i=1===(t=r.readVarint()>>3)?r.readString():2===t?r.readFloat():3===t?r.readDouble():4===t?r.readVarint64():5===t?r.readVarint():6===t?r.readSVarint():7===t?r.readBoolean():null;e.values.push(i)}}function Xt(t,e,r){if(1==t)e.id=r.readVarint();else if(2==t)for(var i=r.readVarint()+r.pos;r.pos<i;){var o=e.layer.keys[r.readVarint()],n=e.layer.values[r.readVarint()];e.properties[o]=n}else 3==t?e.type=r.readVarint():4==t&&(e.geometry=r.pos)}function zt(t,e,r){t.pos=e.features[r];var i=t.readVarint()+t.pos,o={layer:e,type:0,properties:{}};return t.readFields(Xt,o,i),o}var Yt=function(t){function e(e){var r=t.call(this)||this,i=e||{};return r.dataProjection=new P({code:"",units:M.TILE_PIXELS}),r.featureClass_=i.featureClass?i.featureClass:jt,r.geometryName_=i.geometryName,r.layerName_=i.layerName?i.layerName:"layer",r.layers_=i.layers?i.layers:null,r.idProperty_=i.idProperty,r.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"],r}return Bt(e,t),e.prototype.readRawGeometry_=function(t,e,r,i){t.pos=e.geometry;for(var o=t.readVarint()+t.pos,n=1,s=0,a=0,u=0,l=0,h=0;t.pos<o;){if(!s){var p=t.readVarint();n=7&p,s=p>>3}s--,1===n||2===n?(a+=t.readSVarint(),u+=t.readSVarint(),1===n&&l>h&&(i.push(l),h=l),r.push(a,u),l+=2):7===n?l>h&&(r.push(r[h],r[h+1]),l+=2):L(!1,59)}l>h&&(i.push(l),h=l)},e.prototype.createFeature_=function(t,e,a){var u,l=e.type;if(0===l)return null;var h,p=e.properties;this.idProperty_?(h=p[this.idProperty_],delete p[this.idProperty_]):h=e.id,p[this.layerName_]=e.layer.name;var d=[],f=[];this.readRawGeometry_(t,e,d,f);var c=function(t,e){var r;1===t?r=1===e?_.POINT:_.MULTI_POINT:2===t?r=1===e?_.LINE_STRING:_.MULTI_LINE_STRING:3===t&&(r=_.POLYGON);return r}(l,f.length);if(this.featureClass_===jt)(u=new this.featureClass_(c,d,f,p,h)).transform(a.dataProjection);else{var g=void 0;if(c==_.POLYGON){for(var y=[],v=0,T=0,w=0,x=f.length;w<x;++w){var F=f[w];if(G(d,v,F,2)){if(0===y.length)continue;y[y.length-1].push(f[T])}else y.push(f.slice(T,w+1));T=w+1,v=F}g=y.length>1?new r(d,N.XY,y):new V(d,N.XY,f)}else g=c===_.POINT?new D(d,N.XY):c===_.LINE_STRING?new i(d,N.XY):c===_.POLYGON?new V(d,N.XY,f):c===_.MULTI_POINT?new o(d,N.XY):c===_.MULTI_LINE_STRING?new n(d,N.XY,f):null;u=new(0,this.featureClass_),this.geometryName_&&u.setGeometryName(this.geometryName_);var S=s(g,!1,a);u.setGeometry(S),u.setId(h),u.setProperties(p,!0)}return u},e.prototype.getType=function(){return u.ARRAY_BUFFER},e.prototype.readFeatures=function(t,e){var r=this.layers_,i=this.adaptOptions(e),o=R(i.dataProjection);o.setWorldExtent(i.extent),i.dataProjection=o;var n=new vt(t),s=n.readFields(kt,{}),a=[];for(var u in s)if(!r||-1!=r.indexOf(u)){var l=s[u],h=l?[0,0,l.extent,l.extent]:null;o.setExtent(h);for(var p=0,d=l.length;p<d;++p){var f=zt(n,l,p);a.push(this.createFeature_(n,f,i))}}return a},e.prototype.readProjection=function(t){return this.dataProjection},e.prototype.setLayers=function(t){this.layers_=t},e}(a),Kt="image",Zt="hybrid",Ht="vector",Wt=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),qt={image:[f.POLYGON,f.CIRCLE,f.LINE_STRING,f.IMAGE,f.TEXT],hybrid:[f.POLYGON,f.LINE_STRING],vector:[]},Jt={hybrid:[f.IMAGE,f.TEXT,f.DEFAULT],vector:[f.POLYGON,f.CIRCLE,f.LINE_STRING,f.IMAGE,f.TEXT,f.DEFAULT]},Qt=function(t){function e(e){var r=t.call(this,e)||this;return r.boundHandleStyleImageChange_=r.handleStyleImageChange_.bind(r),r.dirty_=!1,r.renderedLayerRevision_,r.renderedPixelToCoordinateTransform_=null,r.renderedRotation_,r.tmpTransform_=I(),r}return Wt(e,t),e.prototype.prepareTile=function(t,e,r){var i,o=t.getState();return o!==A.LOADED&&o!==A.ERROR||(this.updateExecutorGroup_(t,e,r),this.tileImageNeedsRender_(t)&&(i=!0)),i},e.prototype.getTile=function(e,r,i,o){var n=o.pixelRatio,s=o.viewState,a=s.resolution,u=s.projection,l=this.getLayer(),h=l.getSource().getTile(e,r,i,n,u),p=o.viewHints,d=!(p[j.ANIMATING]||p[j.INTERACTING]);return!d&&h.wantedResolution||(h.wantedResolution=a),this.prepareTile(h,n,u)&&(d||Date.now()-o.time<8)&&l.getRenderMode()!==Ht&&this.renderTileImage_(h,o),t.prototype.getTile.call(this,e,r,i,o)},e.prototype.isDrawableTile=function(e){var r=this.getLayer();return t.prototype.isDrawableTile.call(this,e)&&(r.getRenderMode()===Ht?B(r)in e.executorGroups:e.hasContext(r))},e.prototype.getTileImage=function(t){return t.getImage(this.getLayer())},e.prototype.prepareFrame=function(e){var r=this.getLayer().getRevision();return this.renderedLayerRevision_!=r&&(this.renderedTiles.length=0),this.renderedLayerRevision_=r,t.prototype.prepareFrame.call(this,e)},e.prototype.updateExecutorGroup_=function(t,e,r){var i=this.getLayer(),o=i.getRevision(),n=i.getRenderOrder()||null,s=t.wantedResolution,a=t.getReplayState(i);if(a.dirty||a.renderedResolution!==s||a.renderedRevision!=o||a.renderedRenderOrder!=n){var u=i.getSource(),l=i.getDeclutter(),h=u.getTileGrid(),p=u.getTileGridForProjection(r).getTileCoordExtent(t.wrappedTileCoord),d=u.getSourceTiles(e,r,t),f=B(i);delete t.hitDetectionImageData[f],t.executorGroups[f]=[],l&&(t.declutterExecutorGroups[f]=[]);for(var v=function(r,o){var v=d[r];if(v.getState()!=A.LOADED)return"continue";var _=v.tileCoord,w=h.getTileCoordExtent(_),x=Q(p,w),F=U(x,i.getRenderBuffer()*s,T.tmpExtent),S=$(w,x)?null:F;a.dirty=!1;var C=new c(0,F,s,e),m=l?new c(0,x,s,e):void 0,R=y(s,e),E=function(t){var e,r=t.getStyleFunction()||i.getStyleFunction();if(r&&(e=r(t,s)),e){var o=this.renderFeature(t,R,e,C,m);this.dirty_=this.dirty_||o,a.dirty=a.dirty||o}},b=v.getFeatures();n&&n!==a.renderedRenderOrder&&b.sort(n);for(var O=0,I=b.length;O<I;++O){var P=b[O];S&&!tt(S,P.getGeometry().getExtent())||E.call(T,P)}var M=C.finish(),L=i.getRenderMode()!==Ht&&l&&1===d.length?null:x,G=new g(L,s,e,u.getOverlaps(),M,i.getRenderBuffer());if(t.executorGroups[f].push(G),m){var N=new g(null,s,e,u.getOverlaps(),m.finish(),i.getRenderBuffer());t.declutterExecutorGroups[f].push(N)}},T=this,_=0,w=d.length;_<w;++_)v(_);a.renderedRevision=o,a.renderedRenderOrder=n,a.renderedResolution=s}},e.prototype.forEachFeatureAtCoordinate=function(t,e,r,i,o){var n=e.viewState.resolution,s=e.viewState.rotation;r=null==r?0:r;var a=this.getLayer(),u=a.getSource().getTileGridForProjection(e.viewState.projection),l=k([t]);U(l,n*r,l);for(var h,p={},d=function(t,e,r){var n=t.getId();void 0===n&&(n=B(t));var s=p[n];if(s){if(!0!==s&&r<s.distanceSq){if(0===r)return p[n]=!0,o.splice(o.lastIndexOf(s),1),i(t,a,e);s.geometry=e,s.distanceSq=r}}else{if(0===r)return p[n]=!0,i(t,a,e);o.push(p[n]={feature:t,layer:a,geometry:e,distanceSq:r,callback:i})}},f=this.renderedTiles,c=function(i,o){var p=f[i],c=u.getTileCoordExtent(p.wrappedTileCoord);if(!tt(c,l))return"continue";var g=B(a),y=[p.executorGroups[g]],v=p.declutterExecutorGroups[g];v&&y.push(v),y.some((function(i){for(var o=i===v?e.declutterTree.all().map((function(t){return t.value})):null,a=0,u=i.length;a<u;++a){var l=i[a];if(h=l.forEachFeatureAtCoordinate(t,n,s,r,d,o))return!0}}))},g=0,y=f.length;!h&&g<y;++g)c(g);return h},e.prototype.getFeatures=function(t){return new Promise(function(e,r){for(var i,o=this.getLayer(),n=B(o),s=o.getSource(),a=this.renderedProjection,u=a.getExtent(),d=this.renderedResolution,f=s.getTileGridForProjection(a),c=X(this.renderedPixelToCoordinateTransform_,t.slice()),g=f.getTileCoordForCoordAndResolution(c,d),y=0,v=this.renderedTiles.length;y<v;++y)if(g.toString()===this.renderedTiles[y].tileCoord.toString()){if((i=this.renderedTiles[y]).getState()===A.LOADED){var T=f.getTileCoordExtent(i.tileCoord);s.getWrapX()&&a.canWrapX()&&!z(u,T)&&Y(c,a);break}i=void 0}if(!i||i.loadingSourceTiles>0)e([]);else{var _=f.getTileCoordExtent(i.wrappedTileCoord),w=K(_),x=[(c[0]-w[0])/d,(w[1]-c[1])/d],F=i.getSourceTiles().reduce((function(t,e){return t.concat(e.getFeatures())}),[]),S=i.hitDetectionImageData[n];if(!S&&!this.animatingOrInteracting_){var C=Z(f.getTileSize(f.getZForResolution(d))),m=this.renderedRotation_,R=[this.getRenderTransform(f.getTileCoordCenter(i.wrappedTileCoord),d,0,l,C[0]*l,C[1]*l,0)];S=h(C,R,F,o.getStyleFunction(),f.getTileCoordExtent(i.wrappedTileCoord),i.getReplayState(o).renderedResolution,m),i.hitDetectionImageData[n]=S}e(p(x,F,S))}}.bind(this))},e.prototype.handleFontsChanged=function(){var t=this.getLayer();t.getVisible()&&void 0!==this.renderedLayerRevision_&&t.changed()},e.prototype.handleStyleImageChange_=function(t){this.renderIfReadyAndVisible()},e.prototype.renderDeclutter=function(t){var e=this.context,r=e.globalAlpha;e.globalAlpha=this.getLayer().getOpacity();for(var i=t.viewHints,o=!(i[j.ANIMATING]||i[j.INTERACTING]),n=this.renderedTiles,s=0,a=n.length;s<a;++s){var u=n[s],l=u.declutterExecutorGroups[B(this.getLayer())];if(l)for(var h=l.length-1;h>=0;--h)l[h].execute(this.context,1,this.getTileRenderTransform(u,t),t.viewState.rotation,o,void 0,t.declutterTree)}e.globalAlpha=r},e.prototype.getTileRenderTransform=function(t,e){var r=e.pixelRatio,i=e.viewState,o=i.center,n=i.resolution,s=i.rotation,a=e.size,u=Math.round(a[0]*r),l=Math.round(a[1]*r),h=this.getLayer().getSource().getTileGridForProjection(e.viewState.projection),p=t.tileCoord,d=h.getTileCoordExtent(t.wrappedTileCoord),f=h.getTileCoordExtent(p,this.tmpExtent)[0]-d[0];return H(W(this.inversePixelTransform.slice(),1/r,1/r),this.getRenderTransform(o,n,s,r,u,l,f))},e.prototype.renderFrame=function(e,r){var i=e.viewHints,o=!(i[j.ANIMATING]||i[j.INTERACTING]);t.prototype.renderFrame.call(this,e,r),this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice(),this.renderedRotation_=e.viewState.rotation;var n=this.getLayer(),s=n.getRenderMode(),a=this.context,u=a.globalAlpha;a.globalAlpha=n.getOpacity();for(var l=Jt[s],h=e.viewState.rotation,p=this.renderedTiles,d=[],f=[],c=p.length-1;c>=0;--c)for(var g=p[c],y=this.getTileRenderTransform(g,e),v=g.executorGroups[B(n)],T=!1,_=0,w=v.length;_<w;++_){var x=v[_];if(x.hasExecutors(l)){var F=g.tileCoord[0],S=void 0;if(!T&&(S=x.getClipCoords(y))){a.save();for(var C=0,m=d.length;C<m;++C){var R=d[C];F<f[C]&&(a.beginPath(),a.moveTo(S[0],S[1]),a.lineTo(S[2],S[3]),a.lineTo(S[4],S[5]),a.lineTo(S[6],S[7]),a.moveTo(R[6],R[7]),a.lineTo(R[4],R[5]),a.lineTo(R[2],R[3]),a.lineTo(R[0],R[1]),a.clip())}}x.execute(a,1,y,h,o,l),!T&&S&&(a.restore(),d.push(S),f.push(F),T=!0)}}return a.globalAlpha=u,this.container},e.prototype.renderFeature=function(t,e,r,i,o){if(!r)return!1;var n=!1;if(Array.isArray(r))for(var s=0,a=r.length;s<a;++s)n=d(i,t,r[s],e,this.boundHandleStyleImageChange_,void 0,o)||n;else n=d(i,t,r,e,this.boundHandleStyleImageChange_,void 0,o);return n},e.prototype.tileImageNeedsRender_=function(t){var e=this.getLayer();if(e.getRenderMode()===Ht)return!1;var r=t.getReplayState(e),i=e.getRevision(),o=t.wantedResolution;return r.renderedTileResolution!==o||r.renderedTileRevision!==i},e.prototype.renderTileImage_=function(t,e){var r=this.getLayer(),i=t.getReplayState(r),o=r.getRevision(),n=t.executorGroups[B(r)];i.renderedTileRevision=o;var s=t.wrappedTileCoord,a=s[0],u=r.getSource(),l=e.pixelRatio,h=e.viewState.projection,p=u.getTileGridForProjection(h),d=p.getResolution(t.tileCoord[0]),f=e.pixelRatio/t.wantedResolution*d,c=p.getResolution(a),g=t.getContext(r);l=Math.round(Math.max(l,f/l));var y=u.getTilePixelSize(a,l,h);g.canvas.width=y[0],g.canvas.height=y[1];var v=l/f;if(1!==v){var T=q(this.tmpTransform_);W(T,v,v),g.setTransform.apply(g,T)}var _=p.getTileCoordExtent(s,this.tmpExtent),w=f/c,x=q(this.tmpTransform_);W(x,w,-w),J(x,-_[0],-_[3]);for(var F=0,S=n.length;F<S;++F){n[F].execute(g,v,x,0,!0,qt[r.getRenderMode()])}i.renderedTileResolution=t.wantedResolution},e}(ct),$t=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),te=function(t){function e(e){var r=this,i=e||{},o=et({},i);delete o.preload,delete o.useInterimTilesOnError,(r=t.call(this,o)||this).on,r.once,r.un,i.renderMode===Kt&&(console.warn('renderMode: "image" is deprecated. Option ignored.'),i.renderMode=void 0);var n=i.renderMode||Zt;return L(n==Zt||n==Ht,28),r.renderMode_=n,r.setPreload(i.preload?i.preload:0),r.setUseInterimTilesOnError(void 0===i.useInterimTilesOnError||i.useInterimTilesOnError),r}return $t(e,t),e.prototype.createRenderer=function(){return new Qt(this)},e.prototype.getFeatures=function(e){return t.prototype.getFeatures.call(this,e)},e.prototype.getRenderMode=function(){return this.renderMode_},e.prototype.getPreload=function(){return this.get(rt.PRELOAD)},e.prototype.getUseInterimTilesOnError=function(){return this.get(rt.USE_INTERIM_TILES_ON_ERROR)},e.prototype.setPreload=function(t){this.set(rt.PRELOAD,t)},e.prototype.setUseInterimTilesOnError=function(t){this.set(rt.USE_INTERIM_TILES_ON_ERROR,t)},e}(v),ee=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),re=function(t){function e(e,r,i,o,n,s){var a=t.call(this,e,r,s)||this;return a.extent=null,a.format_=o,a.features_=null,a.loader_,a.projection=null,a.resolution,a.tileLoadFunction_=n,a.url_=i,a.key=i,a}return ee(e,t),e.prototype.getFormat=function(){return this.format_},e.prototype.getFeatures=function(){return this.features_},e.prototype.load=function(){this.state==A.IDLE&&(this.setState(A.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))},e.prototype.onLoad=function(t,e){this.setFeatures(t)},e.prototype.onError=function(){this.setState(A.ERROR)},e.prototype.setFeatures=function(t){this.features_=t,this.setState(A.LOADED)},e.prototype.setLoader=function(t){this.loader_=t},e}(it),ie=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),oe=[],ne=function(t){function e(e,r,i,o){var n=t.call(this,e,r,{transition:0})||this;return n.context_={},n.executorGroups={},n.declutterExecutorGroups={},n.loadingSourceTiles=0,n.hitDetectionImageData={},n.replayState_={},n.sourceTiles=[],n.errorTileKeys={},n.wantedResolution,n.getSourceTiles=o.bind(void 0,n),n.wrappedTileCoord=i,n}return ie(e,t),e.prototype.getContext=function(t){var e=B(t);return e in this.context_||(this.context_[e]=ot(1,1,oe)),this.context_[e]},e.prototype.hasContext=function(t){return B(t)in this.context_},e.prototype.getImage=function(t){return this.hasContext(t)?this.getContext(t).canvas:null},e.prototype.getReplayState=function(t){var e=B(t);return e in this.replayState_||(this.replayState_[e]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[e]},e.prototype.load=function(){this.getSourceTiles()},e.prototype.release=function(){for(var e in this.context_)oe.push(this.context_[e].canvas),delete this.context_[e];t.prototype.release.call(this)},e}(it),se=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),ae=function(t){function e(e){var r=this,i=e.projection||"EPSG:3857",o=e.extent||nt(i),n=e.tileGrid||st({extent:o,maxResolution:e.maxResolution,maxZoom:void 0!==e.maxZoom?e.maxZoom:22,minZoom:e.minZoom,tileSize:e.tileSize||512});return(r=t.call(this,{attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,opaque:!1,projection:i,state:e.state,tileGrid:n,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:ue,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition,zDirection:void 0===e.zDirection?1:e.zDirection})||this).format_=e.format?e.format:null,r.sourceTileCache=new at(r.tileCache.highWaterMark),r.overlaps_=null==e.overlaps||e.overlaps,r.tileClass=e.tileClass?e.tileClass:re,r.tileGrids_={},r}return se(e,t),e.prototype.getFeaturesInExtent=function(t){var e=[],r=this.tileCache;if(0===r.getCount())return e;var i=ut(r.peekFirstKey())[0],o=this.tileGrid;return r.forEach((function(r){if(r.tileCoord[0]===i&&r.getState()===A.LOADED)for(var n=r.getSourceTiles(),s=0,a=n.length;s<a;++s){var u=n[s],l=u.tileCoord;if(tt(t,o.getTileCoordExtent(l))){var h=u.getFeatures();if(h)for(var p=0,d=h.length;p<d;++p){var f=h[p],c=f.getGeometry();tt(t,c.getExtent())&&e.push(f)}}}})),e},e.prototype.getOverlaps=function(){return this.overlaps_},e.prototype.clear=function(){this.tileCache.clear(),this.sourceTileCache.clear()},e.prototype.expireCache=function(e,r){var i=this.getTileCacheForProjection(e),o=Object.keys(r).reduce((function(t,e){var r=lt(e);if(i.containsKey(r))for(var o=i.get(r).sourceTiles,n=0,s=o.length;n<s;++n)t[o[n].getKey()]=!0;return t}),{});t.prototype.expireCache.call(this,e,r),this.sourceTileCache.expireCache(o)},e.prototype.getSourceTiles=function(t,e,r){var i=this;if(r.getState()===A.IDLE){r.setState(A.LOADING);var o=r.wrappedTileCoord,n=this.getTileGridForProjection(e),s=n.getTileCoordExtent(o),a=o[0],u=n.getResolution(a);U(s,-u,s);var l=this.tileGrid,h=l.getExtent();h&&Q(s,h,s);var p=l.getZForResolution(u,1);l.forEachTileCoord(s,p,(function(o){var n=i.tileUrlFunction(o,t,e),s=i.sourceTileCache.containsKey(n)?i.sourceTileCache.get(n):new i.tileClass(o,n?A.IDLE:A.EMPTY,n,i.format_,i.tileLoadFunction);r.sourceTiles.push(s);var a=s.getState();if(a<A.LOADED){var u=function(t){i.handleTileChange(t);var e=s.getState();if(e===A.LOADED||e===A.ERROR){var o=s.getKey();o in r.errorTileKeys?s.getState()===A.LOADED&&delete r.errorTileKeys[o]:r.loadingSourceTiles--,e===A.ERROR?r.errorTileKeys[o]=!0:s.removeEventListener(ht.CHANGE,u),0===r.loadingSourceTiles&&r.setState(dt(r.errorTileKeys)?A.LOADED:A.ERROR)}};s.addEventListener(ht.CHANGE,u),r.loadingSourceTiles++}a===A.IDLE&&(s.extent=l.getTileCoordExtent(o),s.projection=e,s.resolution=l.getResolution(o[0]),i.sourceTileCache.set(n,s),s.load())})),r.loadingSourceTiles||r.setState(r.sourceTiles.some((function(t){return t.getState()===A.ERROR}))?A.ERROR:A.LOADED)}return r.sourceTiles},e.prototype.getTile=function(t,e,r,i,o){var n,s=ft(t,e,r),a=this.getKey();if(this.tileCache.containsKey(s)&&(n=this.tileCache.get(s)).key===a)return n;var u=[t,e,r],l=this.getTileCoordForTileUrlFunction(u,o),h=this.getTileGrid().getExtent(),p=this.getTileGridForProjection(o);if(l&&h){var d=p.getTileCoordExtent(l);U(d,-p.getResolution(t),d),tt(h,d)||(l=null)}var f=!0;if(null!==l){var c=this.tileGrid,g=p.getResolution(t),y=c.getZForResolution(g,1),v=p.getTileCoordExtent(l);U(v,-g,v),c.forEachTileCoord(v,y,function(t){f=f&&!this.tileUrlFunction(t,i,o)}.bind(this))}var T=new ne(u,f?A.EMPTY:A.IDLE,l,this.getSourceTiles.bind(this,i,o));return T.key=a,n?(T.interimTile=n,T.refreshInterimChain(),this.tileCache.replace(s,T)):this.tileCache.set(s,T),T},e.prototype.getTileGridForProjection=function(t){var e=t.getCode(),r=this.tileGrids_[e];if(!r){var i=this.tileGrid;r=pt(t,void 0,i?i.getTileSize(i.getMinZoom()):void 0),this.tileGrids_[e]=r}return r},e.prototype.getTilePixelRatio=function(t){return t},e.prototype.getTilePixelSize=function(t,e,r){var i=this.getTileGridForProjection(r),o=Z(i.getTileSize(t),this.tmpSize);return[Math.round(o[0]*e),Math.round(o[1]*e)]},e.prototype.updateCacheSize=function(e,r){t.prototype.updateCacheSize.call(this,2*e,r),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(r).highWaterMark},e}(gt);function ue(t,e){t.setLoader((function(r,i,o){T(e,t.getFormat(),r,i,o,t.onLoad.bind(t),t.onError.bind(t))}))}export{Yt as M,te as V,ae as a};
