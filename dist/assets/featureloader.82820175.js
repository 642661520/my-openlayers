import{az as t,aq as e,aA as i,p as n,aB as o,aC as r,aD as s,aE as a,aF as h,aG as l,aH as c,a9 as u,_ as f,q as _,P as p,o as g,aI as d,aJ as y,aK as m,aL as v,aM as x,aN as S,aO as I,aP as T,aQ as O,aR as L,aS as w,an as C,aT as k,i as E,aU as D,aV as R,aW as M,aX as b,aY as F,D as A,aZ as P,a_ as W,Q as Y,a$ as G,b0 as N,b1 as B,X,S as z,b2 as J,b3 as V,af as U,b4 as j,b5 as H,k as Z,j as K,a6 as q,ay as Q,b6 as $,E as tt,N as et,b7 as it,b8 as nt,b9 as ot,B as rt,ba as st}from"./TileProperty.6da85ab0.js";var at={ARRAY_BUFFER:"arraybuffer",JSON:"json",TEXT:"text",XML:"xml"};function ht(t,e,i,n){for(var o=t[e],r=t[e+1],s=0,a=e+n;a<i;a+=n){var h=t[a],l=t[a+1];s+=Math.sqrt((h-o)*(h-o)+(l-r)*(l-r)),o=h,r=l}return s}function lt(t,e,i,n,o){ct(t,e,i||0,n||t.length-1,o||ft)}function ct(t,e,i,n,o){for(;n>i;){if(n-i>600){var r=n-i+1,s=e-i+1,a=Math.log(r),h=.5*Math.exp(2*a/3),l=.5*Math.sqrt(a*h*(r-h)/r)*(s-r/2<0?-1:1);ct(t,e,Math.max(i,Math.floor(e-s*h/r+l)),Math.min(n,Math.floor(e+(r-s)*h/r+l)),o)}var c=t[e],u=i,f=n;for(ut(t,i,e),o(t[n],c)>0&&ut(t,i,n);u<f;){for(ut(t,u,f),u++,f--;o(t[u],c)<0;)u++;for(;o(t[f],c)>0;)f--}0===o(t[i],c)?ut(t,i,f):ut(t,++f,n),f<=e&&(i=f+1),e<=f&&(n=f-1)}}function ut(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function ft(t,e){return t<e?-1:t>e?1:0}class _t{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const i=[];if(!Ot(t,e))return i;const n=this.toBBox,o=[];for(;e;){for(let r=0;r<e.children.length;r++){const s=e.children[r],a=e.leaf?n(s):s;Ot(t,a)&&(e.leaf?i.push(s):Tt(t,a)?this._all(s,i):o.push(s))}e=o.pop()}return i}collides(t){let e=this.data;if(!Ot(t,e))return!1;const i=[];for(;e;){for(let n=0;n<e.children.length;n++){const o=e.children[n],r=e.leaf?this.toBBox(o):o;if(Ot(t,r)){if(e.leaf||Tt(t,r))return!0;i.push(o)}}e=i.pop()}return!1}load(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(let e=0;e<t.length;e++)this.insert(t[e]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const t=this.data;this.data=e,e=t}this._insert(e,this.data.height-e.height-1,!0)}else this.data=e;return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=Lt([]),this}remove(t,e){if(!t)return this;let i=this.data;const n=this.toBBox(t),o=[],r=[];let s,a,h;for(;i||o.length;){if(i||(i=o.pop(),a=o[o.length-1],s=r.pop(),h=!0),i.leaf){const n=pt(t,i.children,e);if(-1!==n)return i.children.splice(n,1),o.push(i),this._condense(o),this}h||i.leaf||!Tt(i,n)?a?(s++,i=a.children[s],h=!1):i=null:(o.push(i),r.push(s),s=0,a=i,i=i.children[0])}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const i=[];for(;t;)t.leaf?e.push(...t.children):i.push(...t.children),t=i.pop();return e}_build(t,e,i,n){const o=i-e+1;let r,s=this._maxEntries;if(o<=s)return r=Lt(t.slice(e,i+1)),gt(r,this.toBBox),r;n||(n=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,n-1))),r=Lt([]),r.leaf=!1,r.height=n;const a=Math.ceil(o/s),h=a*Math.ceil(Math.sqrt(s));wt(t,e,i,h,this.compareMinX);for(let l=e;l<=i;l+=h){const e=Math.min(l+h-1,i);wt(t,l,e,a,this.compareMinY);for(let i=l;i<=e;i+=a){const o=Math.min(i+a-1,e);r.children.push(this._build(t,i,o,n-1))}}return gt(r,this.toBBox),r}_chooseSubtree(t,e,i,n){for(;n.push(e),!e.leaf&&n.length-1!==i;){let i,n=1/0,s=1/0;for(let a=0;a<e.children.length;a++){const h=e.children[a],l=xt(h),c=(o=t,r=h,(Math.max(r.maxX,o.maxX)-Math.min(r.minX,o.minX))*(Math.max(r.maxY,o.maxY)-Math.min(r.minY,o.minY))-l);c<s?(s=c,n=l<n?l:n,i=h):c===s&&l<n&&(n=l,i=h)}e=i||e.children[0]}var o,r;return e}_insert(t,e,i){const n=i?t:this.toBBox(t),o=[],r=this._chooseSubtree(n,this.data,e,o);for(r.children.push(t),yt(r,n);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(n,o,e)}_split(t,e){const i=t[e],n=i.children.length,o=this._minEntries;this._chooseSplitAxis(i,o,n);const r=this._chooseSplitIndex(i,o,n),s=Lt(i.children.splice(r,i.children.length-r));s.height=i.height,s.leaf=i.leaf,gt(i,this.toBBox),gt(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(i,s)}_splitRoot(t,e){this.data=Lt([t,e]),this.data.height=t.height+1,this.data.leaf=!1,gt(this.data,this.toBBox)}_chooseSplitIndex(t,e,i){let n,o=1/0,r=1/0;for(let s=e;s<=i-e;s++){const e=dt(t,0,s,this.toBBox),a=dt(t,s,i,this.toBBox),h=It(e,a),l=xt(e)+xt(a);h<o?(o=h,n=s,r=l<r?l:r):h===o&&l<r&&(r=l,n=s)}return n||i-e}_chooseSplitAxis(t,e,i){const n=t.leaf?this.compareMinX:mt,o=t.leaf?this.compareMinY:vt;this._allDistMargin(t,e,i,n)<this._allDistMargin(t,e,i,o)&&t.children.sort(n)}_allDistMargin(t,e,i,n){t.children.sort(n);const o=this.toBBox,r=dt(t,0,e,o),s=dt(t,i-e,i,o);let a=St(r)+St(s);for(let h=e;h<i-e;h++){const e=t.children[h];yt(r,t.leaf?o(e):e),a+=St(r)}for(let h=i-e-1;h>=e;h--){const e=t.children[h];yt(s,t.leaf?o(e):e),a+=St(s)}return a}_adjustParentBBoxes(t,e,i){for(let n=i;n>=0;n--)yt(e[n],t)}_condense(t){for(let e,i=t.length-1;i>=0;i--)0===t[i].children.length?i>0?(e=t[i-1].children,e.splice(e.indexOf(t[i]),1)):this.clear():gt(t[i],this.toBBox)}}function pt(t,e,i){if(!i)return e.indexOf(t);for(let n=0;n<e.length;n++)if(i(t,e[n]))return n;return-1}function gt(t,e){dt(t,0,t.children.length,e,t)}function dt(t,e,i,n,o){o||(o=Lt(null)),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(let r=e;r<i;r++){const e=t.children[r];yt(o,t.leaf?n(e):e)}return o}function yt(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function mt(t,e){return t.minX-e.minX}function vt(t,e){return t.minY-e.minY}function xt(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function St(t){return t.maxX-t.minX+(t.maxY-t.minY)}function It(t,e){const i=Math.max(t.minX,e.minX),n=Math.max(t.minY,e.minY),o=Math.min(t.maxX,e.maxX),r=Math.min(t.maxY,e.maxY);return Math.max(0,o-i)*Math.max(0,r-n)}function Tt(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function Ot(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function Lt(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function wt(t,e,i,n,o){const r=[e,i];for(;r.length;){if((i=r.pop())-(e=r.pop())<=n)continue;const s=e+Math.ceil((i-e)/n/2)*n;lt(t,s,e,i,o),r.push(e,s,s,i)}}var Ct=function(){function i(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=e(t.scale),this.displacement_=t.displacement}return i.prototype.clone=function(){var t=this.getScale();return new i({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()})},i.prototype.getOpacity=function(){return this.opacity_},i.prototype.getRotateWithView=function(){return this.rotateWithView_},i.prototype.getRotation=function(){return this.rotation_},i.prototype.getScale=function(){return this.scale_},i.prototype.getScaleArray=function(){return this.scaleArray_},i.prototype.getDisplacement=function(){return this.displacement_},i.prototype.getAnchor=function(){return t()},i.prototype.getImage=function(e){return t()},i.prototype.getHitDetectionImage=function(){return t()},i.prototype.getPixelRatio=function(t){return 1},i.prototype.getImageState=function(){return t()},i.prototype.getImageSize=function(){return t()},i.prototype.getOrigin=function(){return t()},i.prototype.getSize=function(){return t()},i.prototype.setOpacity=function(t){this.opacity_=t},i.prototype.setRotateWithView=function(t){this.rotateWithView_=t},i.prototype.setRotation=function(t){this.rotation_=t},i.prototype.setScale=function(t){this.scale_=t,this.scaleArray_=e(t)},i.prototype.listenImageChange=function(e){t()},i.prototype.load=function(){t()},i.prototype.unlistenImageChange=function(e){t()},i}();function kt(t){return Array.isArray(t)?i(t):t}var Et,Dt=(Et=function(t,e){return(Et=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}Et(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Rt=function(t){function e(e){var i=this,n=void 0!==e.rotateWithView&&e.rotateWithView;return(i=t.call(this,{opacity:1,rotateWithView:n,rotation:void 0!==e.rotation?e.rotation:0,scale:void 0!==e.scale?e.scale:1,displacement:void 0!==e.displacement?e.displacement:[0,0]})||this).canvas_=void 0,i.hitDetectionCanvas_=null,i.fill_=void 0!==e.fill?e.fill:null,i.origin_=[0,0],i.points_=e.points,i.radius_=void 0!==e.radius?e.radius:e.radius1,i.radius2_=e.radius2,i.angle_=void 0!==e.angle?e.angle:0,i.stroke_=void 0!==e.stroke?e.stroke:null,i.anchor_=null,i.size_=null,i.renderOptions_=null,i.render(),i}return Dt(e,t),e.prototype.clone=function(){var t=this.getScale(),i=new e({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice()});return i.setOpacity(this.getOpacity()),i},e.prototype.getAnchor=function(){return this.anchor_},e.prototype.getAngle=function(){return this.angle_},e.prototype.getFill=function(){return this.fill_},e.prototype.getHitDetectionImage=function(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_},e.prototype.getImage=function(t){var e=this.canvas_[t];if(!e){var i=this.renderOptions_,o=n(i.size*t,i.size*t);this.draw_(i,o,t),e=o.canvas,this.canvas_[t]=e}return e},e.prototype.getPixelRatio=function(t){return t},e.prototype.getImageSize=function(){return this.size_},e.prototype.getImageState=function(){return o.LOADED},e.prototype.getOrigin=function(){return this.origin_},e.prototype.getPoints=function(){return this.points_},e.prototype.getRadius=function(){return this.radius_},e.prototype.getRadius2=function(){return this.radius2_},e.prototype.getSize=function(){return this.size_},e.prototype.getStroke=function(){return this.stroke_},e.prototype.listenImageChange=function(t){},e.prototype.load=function(){},e.prototype.unlistenImageChange=function(t){},e.prototype.calculateLineJoinSize_=function(t,e,i){if(0===e||this.points_===1/0||"bevel"!==t&&"miter"!==t)return e;var n=this.radius_,o=void 0===this.radius2_?n:this.radius2_;if(n<o){var r=n;n=o,o=r}var s=void 0===this.radius2_?this.points_:2*this.points_,a=2*Math.PI/s,h=o*Math.sin(a),l=n-Math.sqrt(o*o-h*h),c=Math.sqrt(h*h+l*l),u=c/h;if("miter"===t&&u<=i)return u*e;var f=e/2/u,_=e/2*(l/c),p=Math.sqrt((n+f)*(n+f)+_*_)-n;if(void 0===this.radius2_||"bevel"===t)return 2*p;var g=n*Math.sin(a),d=o-Math.sqrt(n*n-g*g),y=Math.sqrt(g*g+d*d)/g;if(y<=i){var m=y*e/2-o-n;return 2*Math.max(p,m)}return 2*p},e.prototype.createRenderOptions=function(){var t,e=a,i=0,n=null,o=0,r=0;this.stroke_&&(null===(t=this.stroke_.getColor())&&(t=h),t=kt(t),void 0===(r=this.stroke_.getWidth())&&(r=l),n=this.stroke_.getLineDash(),o=this.stroke_.getLineDashOffset(),void 0===(e=this.stroke_.getLineJoin())&&(e=a),void 0===(i=this.stroke_.getMiterLimit())&&(i=c));var s=this.calculateLineJoinSize_(e,r,i),u=Math.max(this.radius_,this.radius2_||0);return{strokeStyle:t,strokeWidth:r,size:Math.ceil(2*u+s),lineDash:n,lineDashOffset:o,lineJoin:e,miterLimit:i}},e.prototype.render=function(){this.renderOptions_=this.createRenderOptions();var t=this.renderOptions_.size,e=this.getDisplacement();this.canvas_={},this.anchor_=[t/2-e[0],t/2+e[1]],this.size_=[t,t]},e.prototype.draw_=function(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){var n=this.fill_.getColor();null===n&&(n=s),e.fillStyle=kt(n),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,e.setLineDash&&t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())},e.prototype.createHitDetectionCanvas_=function(t){if(this.fill_){var e=this.fill_.getColor(),i=0;if("string"==typeof e&&(e=r(e)),null===e?i=1:Array.isArray(e)&&(i=4===e.length?e[3]:1),0===i){var o=n(t.size,t.size);this.hitDetectionCanvas_=o.canvas,this.drawHitDetectionCanvas_(t,o)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))},e.prototype.createPath_=function(t){var e=this.points_,i=this.radius_;if(e===1/0)t.arc(0,0,i,0,2*Math.PI);else{var n=void 0===this.radius2_?i:this.radius2_;void 0!==this.radius2_&&(e*=2);for(var o=this.angle_-Math.PI/2,r=2*Math.PI/e,s=0;s<e;s++){var a=o+s*r,h=s%2==0?i:n;t.lineTo(h*Math.cos(a),h*Math.sin(a))}t.closePath()}},e.prototype.drawHitDetectionCanvas_=function(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=s,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())},e}(Ct),Mt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),bt=function(t){function e(e){var i=e||{};return t.call(this,{points:1/0,fill:i.fill,radius:i.radius,stroke:i.stroke,scale:void 0!==i.scale?i.scale:1,rotation:void 0!==i.rotation?i.rotation:0,rotateWithView:void 0!==i.rotateWithView&&i.rotateWithView,displacement:void 0!==i.displacement?i.displacement:[0,0]})||this}return Mt(e,t),e.prototype.clone=function(){var t=this.getScale(),i=new e({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()});return i.setOpacity(this.getOpacity()),i},e.prototype.setRadius=function(t){this.radius_=t,this.render()},e}(Rt),Ft=function(){function t(t){var e=t||{};this.color_=void 0!==e.color?e.color:null}return t.prototype.clone=function(){var e=this.getColor();return new t({color:Array.isArray(e)?e.slice():e||void 0})},t.prototype.getColor=function(){return this.color_},t.prototype.setColor=function(t){this.color_=t},t}(),At=function(){function t(t){var e=t||{};this.color_=void 0!==e.color?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=void 0!==e.lineDash?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}return t.prototype.clone=function(){var e=this.getColor();return new t({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},t.prototype.getColor=function(){return this.color_},t.prototype.getLineCap=function(){return this.lineCap_},t.prototype.getLineDash=function(){return this.lineDash_},t.prototype.getLineDashOffset=function(){return this.lineDashOffset_},t.prototype.getLineJoin=function(){return this.lineJoin_},t.prototype.getMiterLimit=function(){return this.miterLimit_},t.prototype.getWidth=function(){return this.width_},t.prototype.setColor=function(t){this.color_=t},t.prototype.setLineCap=function(t){this.lineCap_=t},t.prototype.setLineDash=function(t){this.lineDash_=t},t.prototype.setLineDashOffset=function(t){this.lineDashOffset_=t},t.prototype.setLineJoin=function(t){this.lineJoin_=t},t.prototype.setMiterLimit=function(t){this.miterLimit_=t},t.prototype.setWidth=function(t){this.width_=t},t}(),Pt=function(){function t(t){var e=t||{};this.geometry_=null,this.geometryFunction_=Nt,void 0!==e.geometry&&this.setGeometry(e.geometry),this.fill_=void 0!==e.fill?e.fill:null,this.image_=void 0!==e.image?e.image:null,this.renderer_=void 0!==e.renderer?e.renderer:null,this.stroke_=void 0!==e.stroke?e.stroke:null,this.text_=void 0!==e.text?e.text:null,this.zIndex_=e.zIndex}return t.prototype.clone=function(){var e=this.getGeometry();return e&&"object"==typeof e&&(e=e.clone()),new t({geometry:e,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},t.prototype.getRenderer=function(){return this.renderer_},t.prototype.setRenderer=function(t){this.renderer_=t},t.prototype.getGeometry=function(){return this.geometry_},t.prototype.getGeometryFunction=function(){return this.geometryFunction_},t.prototype.getFill=function(){return this.fill_},t.prototype.setFill=function(t){this.fill_=t},t.prototype.getImage=function(){return this.image_},t.prototype.setImage=function(t){this.image_=t},t.prototype.getStroke=function(){return this.stroke_},t.prototype.setStroke=function(t){this.stroke_=t},t.prototype.getText=function(){return this.text_},t.prototype.setText=function(t){this.text_=t},t.prototype.getZIndex=function(){return this.zIndex_},t.prototype.setGeometry=function(t){"function"==typeof t?this.geometryFunction_=t:"string"==typeof t?this.geometryFunction_=function(e){return e.get(t)}:t?void 0!==t&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Nt,this.geometry_=t},t.prototype.setZIndex=function(t){this.zIndex_=t},t}();var Wt=null;function Yt(t,e){if(!Wt){var i=new Ft({color:"rgba(255,255,255,0.4)"}),n=new At({color:"#3399CC",width:1.25});Wt=[new Pt({image:new bt({fill:i,stroke:n,radius:5}),fill:i,stroke:n})]}return Wt}function Gt(){var t={},e=[255,255,255,1],i=[0,153,255,1];return t[u.POLYGON]=[new Pt({fill:new Ft({color:[255,255,255,.5]})})],t[u.MULTI_POLYGON]=t[u.POLYGON],t[u.LINE_STRING]=[new Pt({stroke:new At({color:e,width:5})}),new Pt({stroke:new At({color:i,width:3})})],t[u.MULTI_LINE_STRING]=t[u.LINE_STRING],t[u.CIRCLE]=t[u.POLYGON].concat(t[u.LINE_STRING]),t[u.POINT]=[new Pt({image:new bt({radius:6,fill:new Ft({color:i}),stroke:new At({color:e,width:1.5})}),zIndex:1/0})],t[u.MULTI_POINT]=t[u.POINT],t[u.GEOMETRY_COLLECTION]=t[u.POLYGON].concat(t[u.LINE_STRING],t[u.POINT]),t}function Nt(t){return t.getGeometry()}var Bt=Pt,Xt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),zt="renderOrder",Jt=function(t){function e(e){var i=this,n=e||{},o=_({},n);return delete o.style,delete o.renderBuffer,delete o.updateWhileAnimating,delete o.updateWhileInteracting,(i=t.call(this,o)||this).declutter_=void 0!==n.declutter&&n.declutter,i.renderBuffer_=void 0!==n.renderBuffer?n.renderBuffer:100,i.style_=null,i.styleFunction_=void 0,i.setStyle(n.style),i.updateWhileAnimating_=void 0!==n.updateWhileAnimating&&n.updateWhileAnimating,i.updateWhileInteracting_=void 0!==n.updateWhileInteracting&&n.updateWhileInteracting,i}return Xt(e,t),e.prototype.getDeclutter=function(){return this.declutter_},e.prototype.getFeatures=function(e){return t.prototype.getFeatures.call(this,e)},e.prototype.getRenderBuffer=function(){return this.renderBuffer_},e.prototype.getRenderOrder=function(){return this.get(zt)},e.prototype.getStyle=function(){return this.style_},e.prototype.getStyleFunction=function(){return this.styleFunction_},e.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},e.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},e.prototype.renderDeclutter=function(t){t.declutterTree||(t.declutterTree=new _t(9)),this.getRenderer().renderDeclutter(t)},e.prototype.setRenderOrder=function(t){this.set(zt,t)},e.prototype.setStyle=function(t){this.style_=void 0!==t?t:Yt,this.styleFunction_=null===t?void 0:function(t){var e;if("function"==typeof t)e=t;else{var i;Array.isArray(t)?i=t:(f("function"==typeof t.getZIndex,41),i=[t]),e=function(){return i}}return e}(this.style_),this.changed()},e}(p),Vt={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Ut=[Vt.FILL],jt=[Vt.STROKE],Ht=[Vt.BEGIN_PATH],Zt=[Vt.CLOSE_PATH],Kt=Vt,qt=function(){function t(){}return t.prototype.drawCustom=function(t,e,i){},t.prototype.drawGeometry=function(t){},t.prototype.setStyle=function(t){},t.prototype.drawCircle=function(t,e){},t.prototype.drawFeature=function(t,e){},t.prototype.drawGeometryCollection=function(t,e){},t.prototype.drawLineString=function(t,e){},t.prototype.drawMultiLineString=function(t,e){},t.prototype.drawMultiPoint=function(t,e){},t.prototype.drawMultiPolygon=function(t,e){},t.prototype.drawPoint=function(t,e){},t.prototype.drawPolygon=function(t,e){},t.prototype.drawText=function(t,e){},t.prototype.setFillStrokeStyle=function(t,e){},t.prototype.setImageStyle=function(t,e){},t.prototype.setTextStyle=function(t,e){},t}(),Qt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),$t=function(t){function e(e,i,n,o){var r=t.call(this)||this;return r.tolerance=e,r.maxExtent=i,r.pixelRatio=o,r.maxLineWidth=0,r.resolution=n,r.beginGeometryInstruction1_=null,r.beginGeometryInstruction2_=null,r.bufferedMaxExtent_=null,r.instructions=[],r.coordinates=[],r.tmpCoordinate_=[],r.hitDetectionInstructions=[],r.state={},r}return Qt(e,t),e.prototype.applyPixelRatio=function(t){var e=this.pixelRatio;return 1==e?t:t.map((function(t){return t*e}))},e.prototype.appendFlatPointCoordinates=function(t,e){for(var i=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,o=this.coordinates,r=o.length,s=0,a=t.length;s<a;s+=e)n[0]=t[s],n[1]=t[s+1],g(i,n)&&(o[r++]=n[0],o[r++]=n[1]);return r},e.prototype.appendFlatLineCoordinates=function(t,e,i,n,o,r){var s=this.coordinates,a=s.length,h=this.getBufferedMaxExtent();r&&(e+=n);var l,c,u,f=t[e],_=t[e+1],p=this.tmpCoordinate_,g=!0;for(l=e+n;l<i;l+=n)p[0]=t[l],p[1]=t[l+1],(u=d(h,p))!==c?(g&&(s[a++]=f,s[a++]=_,g=!1),s[a++]=p[0],s[a++]=p[1]):u===y.INTERSECTING?(s[a++]=p[0],s[a++]=p[1],g=!1):g=!0,f=p[0],_=p[1],c=u;return(o&&g||l===e+n)&&(s[a++]=f,s[a++]=_),a},e.prototype.drawCustomCoordinates_=function(t,e,i,n,o){for(var r=0,s=i.length;r<s;++r){var a=i[r],h=this.appendFlatLineCoordinates(t,e,a,n,!1,!1);o.push(h),e=a}return e},e.prototype.drawCustom=function(t,e,i){this.beginGeometry(t,e);var n,o,r,s,a,h=t.getType(),l=t.getStride(),c=this.coordinates.length;if(h==u.MULTI_POLYGON){n=t.getOrientedFlatCoordinates(),s=[];var f=t.getEndss();a=0;for(var _=0,p=f.length;_<p;++_){var g=[];a=this.drawCustomCoordinates_(n,a,f[_],l,g),s.push(g)}this.instructions.push([Kt.CUSTOM,c,s,t,i,m])}else h==u.POLYGON||h==u.MULTI_LINE_STRING?(r=[],n=h==u.POLYGON?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),a=this.drawCustomCoordinates_(n,0,t.getEnds(),l,r),this.instructions.push([Kt.CUSTOM,c,r,t,i,v])):h==u.LINE_STRING||h==u.CIRCLE?(n=t.getFlatCoordinates(),o=this.appendFlatLineCoordinates(n,0,n.length,l,!1,!1),this.instructions.push([Kt.CUSTOM,c,o,t,i,x])):h==u.MULTI_POINT?(n=t.getFlatCoordinates(),(o=this.appendFlatPointCoordinates(n,l))>c&&this.instructions.push([Kt.CUSTOM,c,o,t,i,x])):h==u.POINT&&(n=t.getFlatCoordinates(),this.coordinates.push(n[0],n[1]),o=this.coordinates.length,this.instructions.push([Kt.CUSTOM,c,o,t,i]));this.endGeometry(e)},e.prototype.beginGeometry=function(t,e){this.beginGeometryInstruction1_=[Kt.BEGIN_GEOMETRY,e,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Kt.BEGIN_GEOMETRY,e,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},e.prototype.finish=function(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}},e.prototype.reverseHitDetectionInstructions=function(){var t,e=this.hitDetectionInstructions;e.reverse();var i,n,o=e.length,r=-1;for(t=0;t<o;++t)(n=(i=e[t])[0])==Kt.END_GEOMETRY?r=t:n==Kt.BEGIN_GEOMETRY&&(i[2]=t,S(this.hitDetectionInstructions,r,t),r=-1)},e.prototype.setFillStrokeStyle=function(t,e){var i=this.state;if(t){var n=t.getColor();i.fillStyle=kt(n||s)}else i.fillStyle=void 0;if(e){var o=e.getColor();i.strokeStyle=kt(o||h);var r=e.getLineCap();i.lineCap=void 0!==r?r:I;var u=e.getLineDash();i.lineDash=u?u.slice():T;var f=e.getLineDashOffset();i.lineDashOffset=f||O;var _=e.getLineJoin();i.lineJoin=void 0!==_?_:a;var p=e.getWidth();i.lineWidth=void 0!==p?p:l;var g=e.getMiterLimit();i.miterLimit=void 0!==g?g:c,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0},e.prototype.createFill=function(t){var e=t.fillStyle,i=[Kt.SET_FILL_STYLE,e];return"string"!=typeof e&&i.push(!0),i},e.prototype.applyStroke=function(t){this.instructions.push(this.createStroke(t))},e.prototype.createStroke=function(t){return[Kt.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]},e.prototype.updateFillStyle=function(t,e){var i=t.fillStyle;"string"==typeof i&&t.currentFillStyle==i||(void 0!==i&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)},e.prototype.updateStrokeStyle=function(t,e){var i=t.strokeStyle,n=t.lineCap,o=t.lineDash,r=t.lineDashOffset,s=t.lineJoin,a=t.lineWidth,h=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=n||o!=t.currentLineDash&&!L(t.currentLineDash,o)||t.currentLineDashOffset!=r||t.currentLineJoin!=s||t.currentLineWidth!=a||t.currentMiterLimit!=h)&&(void 0!==i&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=n,t.currentLineDash=o,t.currentLineDashOffset=r,t.currentLineJoin=s,t.currentLineWidth=a,t.currentMiterLimit=h)},e.prototype.endGeometry=function(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var e=[Kt.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)},e.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=w(this.maxExtent),this.maxLineWidth>0)){var t=this.resolution*(this.maxLineWidth+1)/2;C(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_},e}(qt),te=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ee=function(t){function e(e,i,n,o){var r=t.call(this,e,i,n,o)||this;return r.hitDetectionImage_=null,r.image_=null,r.imagePixelRatio_=void 0,r.anchorX_=void 0,r.anchorY_=void 0,r.height_=void 0,r.opacity_=void 0,r.originX_=void 0,r.originY_=void 0,r.rotateWithView_=void 0,r.rotation_=void 0,r.scale_=void 0,r.width_=void 0,r.declutterImageWithText_=void 0,r}return te(e,t),e.prototype.drawPoint=function(t,e){if(this.image_){this.beginGeometry(t,e);var i=t.getFlatCoordinates(),n=t.getStride(),o=this.coordinates.length,r=this.appendFlatPointCoordinates(i,n);this.instructions.push([Kt.DRAW_IMAGE,o,r,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterImageWithText_]),this.hitDetectionInstructions.push([Kt.DRAW_IMAGE,o,r,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterImageWithText_]),this.endGeometry(e)}},e.prototype.drawMultiPoint=function(t,e){if(this.image_){this.beginGeometry(t,e);var i=t.getFlatCoordinates(),n=t.getStride(),o=this.coordinates.length,r=this.appendFlatPointCoordinates(i,n);this.instructions.push([Kt.DRAW_IMAGE,o,r,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterImageWithText_]),this.hitDetectionInstructions.push([Kt.DRAW_IMAGE,o,r,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterImageWithText_]),this.endGeometry(e)}},e.prototype.finish=function(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,t.prototype.finish.call(this)},e.prototype.setImageStyle=function(t,e){var i=t.getAnchor(),n=t.getSize(),o=t.getHitDetectionImage(),r=t.getImage(this.pixelRatio),s=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=o,this.image_=r,this.height_=n[1],this.opacity_=t.getOpacity(),this.originX_=s[0]*this.imagePixelRatio_,this.originY_=s[1]*this.imagePixelRatio_,this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=n[0],this.declutterImageWithText_=e},e}($t),ie=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ne=function(t){function e(e,i,n,o){return t.call(this,e,i,n,o)||this}return ie(e,t),e.prototype.drawFlatCoordinates_=function(t,e,i,n){var o=this.coordinates.length,r=this.appendFlatLineCoordinates(t,e,i,n,!1,!1),s=[Kt.MOVE_TO_LINE_TO,o,r];return this.instructions.push(s),this.hitDetectionInstructions.push(s),i},e.prototype.drawLineString=function(t,e){var i=this.state,n=i.strokeStyle,o=i.lineWidth;if(void 0!==n&&void 0!==o){this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([Kt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,T,O],Ht);var r=t.getFlatCoordinates(),s=t.getStride();this.drawFlatCoordinates_(r,0,r.length,s),this.hitDetectionInstructions.push(jt),this.endGeometry(e)}},e.prototype.drawMultiLineString=function(t,e){var i=this.state,n=i.strokeStyle,o=i.lineWidth;if(void 0!==n&&void 0!==o){this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([Kt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset],Ht);for(var r=t.getEnds(),s=t.getFlatCoordinates(),a=t.getStride(),h=0,l=0,c=r.length;l<c;++l)h=this.drawFlatCoordinates_(s,h,r[l],a);this.hitDetectionInstructions.push(jt),this.endGeometry(e)}},e.prototype.finish=function(){var e=this.state;return null!=e.lastStroke&&e.lastStroke!=this.coordinates.length&&this.instructions.push(jt),this.reverseHitDetectionInstructions(),this.state=null,t.prototype.finish.call(this)},e.prototype.applyStroke=function(e){null!=e.lastStroke&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(jt),e.lastStroke=this.coordinates.length),e.lastStroke=0,t.prototype.applyStroke.call(this,e),this.instructions.push(Ht)},e}($t),oe=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),re=function(t){function e(e,i,n,o){return t.call(this,e,i,n,o)||this}return oe(e,t),e.prototype.drawFlatCoordinatess_=function(t,e,i,n){var o=this.state,r=void 0!==o.fillStyle,s=void 0!==o.strokeStyle,a=i.length;this.instructions.push(Ht),this.hitDetectionInstructions.push(Ht);for(var h=0;h<a;++h){var l=i[h],c=this.coordinates.length,u=this.appendFlatLineCoordinates(t,e,l,n,!0,!s),f=[Kt.MOVE_TO_LINE_TO,c,u];this.instructions.push(f),this.hitDetectionInstructions.push(f),s&&(this.instructions.push(Zt),this.hitDetectionInstructions.push(Zt)),e=l}return r&&(this.instructions.push(Ut),this.hitDetectionInstructions.push(Ut)),s&&(this.instructions.push(jt),this.hitDetectionInstructions.push(jt)),e},e.prototype.drawCircle=function(t,e){var i=this.state,n=i.fillStyle,o=i.strokeStyle;if(void 0!==n||void 0!==o){this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([Kt.SET_FILL_STYLE,s]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([Kt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);var r=t.getFlatCoordinates(),a=t.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(r,0,r.length,a,!1,!1);var l=[Kt.CIRCLE,h];this.instructions.push(Ht,l),this.hitDetectionInstructions.push(Ht,l),void 0!==i.fillStyle&&(this.instructions.push(Ut),this.hitDetectionInstructions.push(Ut)),void 0!==i.strokeStyle&&(this.instructions.push(jt),this.hitDetectionInstructions.push(jt)),this.endGeometry(e)}},e.prototype.drawPolygon=function(t,e){var i=this.state,n=i.fillStyle,o=i.strokeStyle;if(void 0!==n||void 0!==o){this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([Kt.SET_FILL_STYLE,s]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([Kt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);var r=t.getEnds(),a=t.getOrientedFlatCoordinates(),h=t.getStride();this.drawFlatCoordinatess_(a,0,r,h),this.endGeometry(e)}},e.prototype.drawMultiPolygon=function(t,e){var i=this.state,n=i.fillStyle,o=i.strokeStyle;if(void 0!==n||void 0!==o){this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([Kt.SET_FILL_STYLE,s]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([Kt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);for(var r=t.getEndss(),a=t.getOrientedFlatCoordinates(),h=t.getStride(),l=0,c=0,u=r.length;c<u;++c)l=this.drawFlatCoordinatess_(a,l,r[c],h);this.endGeometry(e)}},e.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var e=this.tolerance;if(0!==e)for(var i=this.coordinates,n=0,o=i.length;n<o;++n)i[n]=k(i[n],e);return t.prototype.finish.call(this)},e.prototype.setFillStrokeStyles_=function(){var t=this.state;void 0!==t.fillStyle&&this.updateFillStyle(t,this.createFill),void 0!==t.strokeStyle&&this.updateStrokeStyle(t,this.applyStroke)},e}($t),se={POINT:"point",LINE:"line"};function ae(t,e,i,n,o){var r,s,a,h,l,c,u,f,_,p=i,g=i,d=0,y=0,m=i;for(r=i;r<n;r+=o){var v=e[r],x=e[r+1];void 0!==h&&(f=v-h,_=x-l,a=Math.sqrt(f*f+_*_),void 0!==c&&(y+=s,Math.acos((c*f+u*_)/(s*a))>t&&(y>d&&(d=y,p=m,g=r),y=0,m=r-o)),s=a,c=f,u=_),h=v,l=x}return(y+=a)>d?[m,r]:[p,g]}var he=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),le={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},ce={Circle:re,Default:$t,Image:ee,LineString:ne,Polygon:re,Text:function(t){function e(e,i,n,o){var r=t.call(this,e,i,n,o)||this;return r.labels_=null,r.text_="",r.textOffsetX_=0,r.textOffsetY_=0,r.textRotateWithView_=void 0,r.textRotation_=0,r.textFillState_=null,r.fillStates={},r.textStrokeState_=null,r.strokeStates={},r.textState_={},r.textStates={},r.textKey_="",r.fillKey_="",r.strokeKey_="",r.declutterImageWithText_=void 0,r}return he(e,t),e.prototype.finish=function(){var e=t.prototype.finish.call(this);return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e},e.prototype.drawText=function(t,e){var i=this.textFillState_,n=this.textStrokeState_,o=this.textState_;if(""!==this.text_&&o&&(i||n)){var r=this.coordinates,s=r.length,a=t.getType(),h=null,l=t.getStride();if(o.placement!==se.LINE||a!=u.LINE_STRING&&a!=u.MULTI_LINE_STRING&&a!=u.POLYGON&&a!=u.MULTI_POLYGON){var c=o.overflow?null:[];switch(a){case u.POINT:case u.MULTI_POINT:h=t.getFlatCoordinates();break;case u.LINE_STRING:h=t.getFlatMidpoint();break;case u.CIRCLE:h=t.getCenter();break;case u.MULTI_LINE_STRING:h=t.getFlatMidpoints(),l=2;break;case u.POLYGON:h=t.getFlatInteriorPoint(),o.overflow||c.push(h[2]/this.resolution),l=3;break;case u.MULTI_POLYGON:var f=t.getFlatInteriorPoints();h=[];for(T=0,O=f.length;T<O;T+=3)o.overflow||c.push(f[T+2]/this.resolution),h.push(f[T],f[T+1]);if(0===h.length)return;l=2}if((b=this.appendFlatPointCoordinates(h,l))===s)return;if(c&&(b-s)/2!=h.length/l){var _=s/2;c=c.filter((function(t,e){var i=r[2*(_+e)]===h[e*l]&&r[2*(_+e)+1]===h[e*l+1];return i||--_,i}))}this.saveTextStates_(),(o.backgroundFill||o.backgroundStroke)&&(this.setFillStrokeStyle(o.backgroundFill,o.backgroundStroke),o.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),o.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e);var p=o.padding;if(p!=D&&(o.scale[0]<0||o.scale[1]<0)){var g=o.padding[0],d=o.padding[1],y=o.padding[2],m=o.padding[3];o.scale[0]<0&&(d=-d,m=-m),o.scale[1]<0&&(g=-g,y=-y),p=[g,d,y,m]}var v=this.pixelRatio;this.instructions.push([Kt.DRAW_IMAGE,s,b,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterImageWithText_,p==D?D:p.map((function(t){return t*v})),!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,c]);var x=1/v;this.hitDetectionInstructions.push([Kt.DRAW_IMAGE,s,b,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[x,x],NaN,this.declutterImageWithText_,p,!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,c]),this.endGeometry(e)}else{if(!E(this.getBufferedMaxExtent(),t.getExtent()))return;var S=void 0;if(h=t.getFlatCoordinates(),a==u.LINE_STRING)S=[h.length];else if(a==u.MULTI_LINE_STRING)S=t.getEnds();else if(a==u.POLYGON)S=t.getEnds().slice(0,1);else if(a==u.MULTI_POLYGON){var I=t.getEndss();S=[];for(var T=0,O=I.length;T<O;++T)S.push(I[T][0])}this.beginGeometry(t,e);for(var L=o.textAlign,w=0,C=void 0,k=0,R=S.length;k<R;++k){if(null==L){var M=ae(o.maxAngle,h,w,S[k],l);w=M[0],C=M[1]}else C=S[k];for(var T=w;T<C;T+=l)r.push(h[T],h[T+1]);var b=r.length;w=S[k],this.drawChars_(s,b),s=b}this.endGeometry(e)}}},e.prototype.saveTextStates_=function(){var t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,n=this.strokeKey_;t&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));var o=this.textKey_;o in this.textStates||(this.textStates[o]={font:e.font,textAlign:e.textAlign||R,textBaseline:e.textBaseline||M,scale:e.scale});var r=this.fillKey_;i&&(r in this.fillStates||(this.fillStates[r]={fillStyle:i.fillStyle}))},e.prototype.drawChars_=function(t,e){var i=this.textStrokeState_,n=this.textState_,o=this.strokeKey_,r=this.textKey_,s=this.fillKey_;this.saveTextStates_();var a=this.pixelRatio,h=le[n.textBaseline],l=this.textOffsetY_*a,c=this.text_,u=i?i.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([Kt.DRAW_CHARS,t,e,h,n.overflow,s,n.maxAngle,a,l,o,u*a,c,r,1]),this.hitDetectionInstructions.push([Kt.DRAW_CHARS,t,e,h,n.overflow,s,n.maxAngle,1,l,o,u,c,r,1/a])},e.prototype.setTextStyle=function(t,e){var i,n,o;if(t){var r=t.getFill();r?((n=this.textFillState_)||(n={},this.textFillState_=n),n.fillStyle=kt(r.getColor()||s)):(n=null,this.textFillState_=n);var u=t.getStroke();if(u){(o=this.textStrokeState_)||(o={},this.textStrokeState_=o);var f=u.getLineDash(),_=u.getLineDashOffset(),p=u.getWidth(),g=u.getMiterLimit();o.lineCap=u.getLineCap()||I,o.lineDash=f?f.slice():T,o.lineDashOffset=void 0===_?O:_,o.lineJoin=u.getLineJoin()||a,o.lineWidth=void 0===p?l:p,o.miterLimit=void 0===g?c:g,o.strokeStyle=kt(u.getColor()||h)}else o=null,this.textStrokeState_=o;i=this.textState_;var d=t.getFont()||b;F(d);var y=t.getScaleArray();i.overflow=t.getOverflow(),i.font=d,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.textBaseline=t.getTextBaseline()||M,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||D,i.scale=void 0===y?[1,1]:y;var m=t.getOffsetX(),v=t.getOffsetY(),x=t.getRotateWithView(),S=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=void 0===m?0:m,this.textOffsetY_=void 0===v?0:v,this.textRotateWithView_=void 0!==x&&x,this.textRotation_=void 0===S?0:S,this.strokeKey_=o?("string"==typeof o.strokeStyle?o.strokeStyle:A(o.strokeStyle))+o.lineCap+o.lineDashOffset+"|"+o.lineWidth+o.lineJoin+o.miterLimit+"["+o.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.textBaseline||"?"),this.fillKey_=n?"string"==typeof n.fillStyle?n.fillStyle:"|"+A(n.fillStyle):""}else this.text_="";this.declutterImageWithText_=e},e}($t)},ue=function(){function t(t,e,i,n){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=n,this.resolution_=i,this.buildersByZIndex_={}}return t.prototype.finish=function(){var t={};for(var e in this.buildersByZIndex_){t[e]=t[e]||{};var i=this.buildersByZIndex_[e];for(var n in i){var o=i[n].finish();t[e][n]=o}}return t},t.prototype.getBuilder=function(t,e){var i=void 0!==t?t.toString():"0",n=this.buildersByZIndex_[i];void 0===n&&(n={},this.buildersByZIndex_[i]=n);var o=n[e];void 0===o&&(o=new(0,ce[e])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[e]=o);return o},t}(),fe={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"};function _e(t,e,i,n,o,r,s,a,h,l,c,u){var f=t[e],_=t[e+1],p=0,g=0,d=0,y=0;function m(){p=f,g=_,f=t[e+=n],_=t[e+1],y+=d,d=Math.sqrt((f-p)*(f-p)+(_-g)*(_-g))}do{m()}while(e<i-n&&y+d<r);for(var v=0===d?0:(r-y)/d,x=W(p,f,v),S=W(g,_,v),I=e-n,T=y,O=r+a*h(l,o,c);e<i-n&&y+d<O;)m();var L,w=W(p,f,v=0===d?0:(O-y)/d),C=W(g,_,v);if(u){var k=[x,S,w,C];P(k,0,4,2,u,k,k),L=k[0]>k[2]}else L=x>w;var E,D=Math.PI,R=[],M=I+n===e;if(d=0,y=T,f=t[e=I],_=t[e+1],M){m(),E=Math.atan2(_-g,f-p),L&&(E+=E>0?-D:D);var b=(w+x)/2,F=(C+S)/2;return R[0]=[b,F,(O-r)/2,E,o],R}for(var A=0,Y=o.length;A<Y;){m();var G=Math.atan2(_-g,f-p);if(L&&(G+=G>0?-D:D),void 0!==E){var N=G-E;if(N+=N>D?-2*D:N<-D?2*D:0,Math.abs(N)>s)return null}E=G;for(var B=A,X=0;A<Y;++A){var z=a*h(l,o[L?Y-A-1:A],c);if(e+n<i&&y+d<r+X+z/2)break;X+=z}if(A!==B){var J=L?o.substring(Y-B,Y-A):o.substring(B,A);b=W(p,f,v=0===d?0:(r+X/2-y)/d),F=W(g,_,v);R.push([b,F,X/2,G,J]),r+=X}}return R}var pe=Z(),ge=[],de=[],ye=[],me=[];function ve(t){return t[3].declutterBox}var xe=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function Se(t,e){return"start"!==e&&"end"!==e||xe.test(t)||(e="start"===e?"left":"right"),le[e]}var Ie=function(){function t(t,e,i,n){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.alignFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=Y(),this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={}}return t.prototype.createLabel=function(t,e,i,n){var o=t+e+i+n;if(this.labels_[o])return this.labels_[o];var r=n?this.strokeStates[n]:null,s=i?this.fillStates[i]:null,a=this.textStates[e],h=this.pixelRatio,l=[a.scale[0]*h,a.scale[1]*h],c=Se(t,a.textAlign||R),u=n&&r.lineWidth?r.lineWidth:0,f=t.split("\n"),_=f.length,p=[],g=G(a.font,f,p),d=N(a.font),y=g+u,m=[],v=(y+2)*l[0],x=(d*_+u)*l[1],S={width:v<0?Math.floor(v):Math.ceil(v),height:x<0?Math.floor(x):Math.ceil(x),contextInstructions:m};(1==l[0]&&1==l[1]||m.push("scale",l),m.push("font",a.font),n)&&(m.push("strokeStyle",r.strokeStyle),m.push("lineWidth",u),m.push("lineCap",r.lineCap),m.push("lineJoin",r.lineJoin),m.push("miterLimit",r.miterLimit),(B?OffscreenCanvasRenderingContext2D:CanvasRenderingContext2D).prototype.setLineDash&&(m.push("setLineDash",[r.lineDash]),m.push("lineDashOffset",r.lineDashOffset)));i&&m.push("fillStyle",s.fillStyle),m.push("textBaseline","middle"),m.push("textAlign","center");var I,T=.5-c,O=c*y+T*u;if(n)for(I=0;I<_;++I)m.push("strokeText",[f[I],O+T*p[I],.5*(u+d)+I*d]);if(i)for(I=0;I<_;++I)m.push("fillText",[f[I],O+T*p[I],.5*(u+d)+I*d]);return this.labels_[o]=S,S},t.prototype.replayTextBackground_=function(t,e,i,n,o,r,s){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,n),t.lineTo.apply(t,o),t.lineTo.apply(t,e),r&&(this.alignFill_=r[2],this.fill_(t)),s&&(this.setStrokeStyle_(t,s),t.stroke())},t.prototype.calculateImageOrLabelDimensions_=function(t,e,i,n,o,r,s,a,h,l,c,u,f,_,p,g){var d,y=i-(s*=u[0]),m=n-(a*=u[1]),v=o+h>t?t-h:o,x=r+l>e?e-l:r,S=_[3]+v*u[0]+_[1],I=_[0]+x*u[1]+_[2],T=y-_[3],O=m-_[0];return(p||0!==c)&&(ge[0]=T,me[0]=T,ge[1]=O,de[1]=O,de[0]=T+S,ye[0]=de[0],ye[1]=O+I,me[1]=ye[1]),0!==c?(d=X(Y(),i,n,1,1,c,-i,-n),z(d,ge),z(d,de),z(d,ye),z(d,me),J(Math.min(ge[0],de[0],ye[0],me[0]),Math.min(ge[1],de[1],ye[1],me[1]),Math.max(ge[0],de[0],ye[0],me[0]),Math.max(ge[1],de[1],ye[1],me[1]),pe)):J(Math.min(T,T+S),Math.min(O,O+I),Math.max(T,T+S),Math.max(O,O+I),pe),f&&(y=Math.round(y),m=Math.round(m)),{drawImageX:y,drawImageY:m,drawImageW:v,drawImageH:x,originX:h,originY:l,declutterBox:{minX:pe[0],minY:pe[1],maxX:pe[2],maxY:pe[3],value:g},canvasTransform:d,scale:u}},t.prototype.replayImageOrLabel_=function(t,e,i,n,o,r,s){var a=!(!r&&!s),h=n.declutterBox,l=t.canvas,c=s?s[2]*n.scale[0]/2:0;return h.minX-c<=l.width/e&&h.maxX+c>=0&&h.minY-c<=l.height/e&&h.maxY+c>=0&&(a&&this.replayTextBackground_(t,ge,de,ye,me,r,s),V(t,n.canvasTransform,o,i,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0},t.prototype.fill_=function(t){if(this.alignFill_){var e=z(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;t.save(),t.translate(e[0]%i,e[1]%i),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.restore()},t.prototype.setStrokeStyle_=function(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.setLineDash&&(t.lineDashOffset=e[7],t.setLineDash(e[6]))},t.prototype.drawLabelWithPointPlacement_=function(t,e,i,n){var o=this.textStates[e],r=this.createLabel(t,e,n,i),s=this.strokeStates[i],a=this.pixelRatio,h=Se(t,o.textAlign||R),l=le[o.textBaseline||M],c=s&&s.lineWidth?s.lineWidth:0;return{label:r,anchorX:h*(r.width/a-2*o.scale[0])+2*(.5-h)*c,anchorY:l*r.height/a+2*(.5-l)*c}},t.prototype.execute_=function(t,e,i,n,o,r,s,a){var h;this.pixelCoordinates_&&L(i,this.renderedTransform_)?h=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),h=U(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),j(this.renderedTransform_,i));for(var l,c,u,f,_,p,g,d,y,m,v,x,S,I,T,O,w=0,C=n.length,k=0,R=0,M=0,b=null,F=null,A=this.coordinateCache_,P=this.viewRotation_,W=Math.round(1e12*Math.atan2(-i[1],i[0]))/1e12,Y={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:P},G=this.instructions!=n||this.overlaps?0:200;w<C;){var N=n[w];switch(N[0]){case Kt.BEGIN_GEOMETRY:S=N[1],O=N[3],S.getGeometry()?void 0===s||E(s,O.getExtent())?++w:w=N[2]+1:w=N[2];break;case Kt.BEGIN_PATH:R>G&&(this.fill_(t),R=0),M>G&&(t.stroke(),M=0),R||M||(t.beginPath(),f=NaN,_=NaN),++w;break;case Kt.CIRCLE:var B=h[k=N[1]],X=h[k+1],z=h[k+2]-B,J=h[k+3]-X,V=Math.sqrt(z*z+J*J);t.moveTo(B+V,X),t.arc(B,X,V,0,2*Math.PI,!0),++w;break;case Kt.CLOSE_PATH:t.closePath(),++w;break;case Kt.CUSTOM:k=N[1],l=N[2];var Z=N[3],K=N[4],q=6==N.length?N[5]:void 0;Y.geometry=Z,Y.feature=S,w in A||(A[w]=[]);var Q=A[w];q?q(h,k,l,2,Q):(Q[0]=h[k],Q[1]=h[k+1],Q.length=2),K(Q,Y),++w;break;case Kt.DRAW_IMAGE:k=N[1],l=N[2],d=N[3],c=N[4],u=N[5];var $=N[6],tt=N[7],et=N[8],it=N[9],nt=N[10],ot=N[11],rt=N[12],st=N[13],at=N[14];if(!d&&N.length>=19){y=N[18],m=N[19],v=N[20],x=N[21];var lt=this.drawLabelWithPointPlacement_(y,m,v,x);d=lt.label,N[3]=d;var ct=N[22];c=(lt.anchorX-ct)*this.pixelRatio,N[4]=c;var ut=N[23];u=(lt.anchorY-ut)*this.pixelRatio,N[5]=u,$=d.height,N[6]=$,st=d.width,N[13]=st}var ft=void 0;N.length>24&&(ft=N[24]);var _t=void 0,pt=void 0,gt=void 0;N.length>16?(_t=N[15],pt=N[16],gt=N[17]):(_t=D,pt=!1,gt=!1),nt&&W?ot+=P:nt||W||(ot-=P);for(var dt=0;k<l;k+=2)if(!(ft&&ft[dt++]<st/this.pixelRatio)){var yt=[t,e,d,Jt=this.calculateImageOrLabelDimensions_(d.width,d.height,h[k],h[k+1],st,$,c,u,et,it,ot,rt,o,_t,pt||gt,S),tt,pt?b:null,gt?F:null],mt=void 0,vt=void 0;if(a&&at){var xt=l-k;if(!at[xt]){at[xt]=yt;continue}if(mt=at[xt],delete at[xt],vt=ve(mt),a.collides(vt))continue}a&&a.collides(Jt.declutterBox)||(mt&&(a&&a.insert(vt),this.replayImageOrLabel_.apply(this,mt)),a&&a.insert(Jt.declutterBox),this.replayImageOrLabel_.apply(this,yt))}++w;break;case Kt.DRAW_CHARS:var St=N[1],It=N[2],Tt=N[3],Ot=N[4];x=N[5];var Lt=N[6],wt=N[7],Ct=N[8];v=N[9];var kt=N[10];y=N[11],m=N[12];var Et=[N[13],N[13]],Dt=this.textStates[m],Rt=Dt.font,Mt=[Dt.scale[0]*wt,Dt.scale[1]*wt],bt=void 0;Rt in this.widths_?bt=this.widths_[Rt]:(bt={},this.widths_[Rt]=bt);var Ft=ht(h,St,It,2),At=Math.abs(Mt[0])*H(Rt,y,bt);if(Ot||At<=Ft){var Pt=this.textStates[m].textAlign,Wt=_e(h,St,It,2,y,(Ft-At)*le[Pt],Lt,Math.abs(Mt[0]),H,Rt,bt,W?0:this.viewRotation_);t:if(Wt){var Yt=[],Gt=void 0,Nt=void 0,Bt=void 0,Xt=void 0,zt=void 0;if(v)for(Gt=0,Nt=Wt.length;Gt<Nt;++Gt){Bt=(zt=Wt[Gt])[4],Xt=this.createLabel(Bt,m,"",v),c=zt[2]+(Mt[0]<0?-kt:kt),u=Tt*Xt.height+2*(.5-Tt)*kt*Mt[1]/Mt[0]-Ct;var Jt=this.calculateImageOrLabelDimensions_(Xt.width,Xt.height,zt[0],zt[1],Xt.width,Xt.height,c,u,0,0,zt[3],Et,!1,D,!1,S);if(a&&a.collides(Jt.declutterBox))break t;Yt.push([t,e,Xt,Jt,1,null,null])}if(x)for(Gt=0,Nt=Wt.length;Gt<Nt;++Gt){Bt=(zt=Wt[Gt])[4],Xt=this.createLabel(Bt,m,x,""),c=zt[2],u=Tt*Xt.height-Ct;Jt=this.calculateImageOrLabelDimensions_(Xt.width,Xt.height,zt[0],zt[1],Xt.width,Xt.height,c,u,0,0,zt[3],Et,!1,D,!1,S);if(a&&a.collides(Jt.declutterBox))break t;Yt.push([t,e,Xt,Jt,1,null,null])}a&&a.load(Yt.map(ve));for(var Vt=0,Ut=Yt.length;Vt<Ut;++Vt)this.replayImageOrLabel_.apply(this,Yt[Vt])}}++w;break;case Kt.END_GEOMETRY:if(void 0!==r){var jt=r(S=N[1],O);if(jt)return jt}++w;break;case Kt.FILL:G?R++:this.fill_(t),++w;break;case Kt.MOVE_TO_LINE_TO:for(k=N[1],l=N[2],I=h[k],g=(T=h[k+1])+.5|0,(p=I+.5|0)===f&&g===_||(t.moveTo(I,T),f=p,_=g),k+=2;k<l;k+=2)p=(I=h[k])+.5|0,g=(T=h[k+1])+.5|0,k!=l-2&&p===f&&g===_||(t.lineTo(I,T),f=p,_=g);++w;break;case Kt.SET_FILL_STYLE:b=N,this.alignFill_=N[2],R&&(this.fill_(t),R=0,M&&(t.stroke(),M=0)),t.fillStyle=N[1],++w;break;case Kt.SET_STROKE_STYLE:F=N,M&&(t.stroke(),M=0),this.setStrokeStyle_(t,N),++w;break;case Kt.STROKE:G?M++:t.stroke(),++w;break;default:++w}}R&&this.fill_(t),M&&t.stroke()},t.prototype.execute=function(t,e,i,n,o,r){this.viewRotation_=n,this.execute_(t,e,i,this.instructions,o,void 0,void 0,r)},t.prototype.executeHitDetection=function(t,e,i,n,o){return this.viewRotation_=i,this.execute_(t,1,e,this.hitDetectionInstructions,!0,n,o)},t}(),Te=[fe.POLYGON,fe.CIRCLE,fe.LINE_STRING,fe.IMAGE,fe.TEXT,fe.DEFAULT],Oe=function(){function t(t,e,i,n,o,r){this.maxExtent_=t,this.overlaps_=n,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=r,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Y(),this.createExecutors_(o)}return t.prototype.clip=function(t,e){var i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()},t.prototype.createExecutors_=function(t){for(var e in t){var i=this.executorsByZIndex_[e];void 0===i&&(i={},this.executorsByZIndex_[e]=i);var n=t[e];for(var o in n){var r=n[o];i[o]=new Ie(this.resolution_,this.pixelRatio_,this.overlaps_,r)}}},t.prototype.hasExecutors=function(t){for(var e in this.executorsByZIndex_)for(var i=this.executorsByZIndex_[e],n=0,o=t.length;n<o;++n)if(t[n]in i)return!0;return!1},t.prototype.forEachFeatureAtCoordinate=function(t,e,i,o,r,s){var a=2*(o=Math.round(o))+1,h=X(this.hitDetectionTransform_,o+.5,o+.5,1/e,-1/e,-i,-t[0],-t[1]),l=!this.hitDetectionContext_;l&&(this.hitDetectionContext_=n(a,a));var c,u=this.hitDetectionContext_;u.canvas.width!==a||u.canvas.height!==a?(u.canvas.width=a,u.canvas.height=a):l||u.clearRect(0,0,a,a),void 0!==this.renderBuffer_&&(c=Z(),K(c,t),C(c,e*(this.renderBuffer_+o),c));var f,_=function(t){if(void 0!==Le[t])return Le[t];for(var e=2*t+1,i=t*t,n=new Array(i+1),o=0;o<=t;++o)for(var r=0;r<=t;++r){var s=o*o+r*r;if(s>i)break;var a=n[s];a||(a=[],n[s]=a),a.push(4*((t+o)*e+(t+r))+3),o>0&&a.push(4*((t-o)*e+(t+r))+3),r>0&&(a.push(4*((t+o)*e+(t-r))+3),o>0&&a.push(4*((t-o)*e+(t-r))+3))}for(var h=[],l=(o=0,n.length);o<l;++o)n[o]&&h.push.apply(h,n[o]);return Le[t]=h,h}(o);function p(t,e){for(var i=u.getImageData(0,0,a,a).data,n=0,h=_.length;n<h;n++)if(i[_[n]]>0){if(!s||f!==fe.IMAGE&&f!==fe.TEXT||-1!==s.indexOf(t)){var l=(_[n]-3)/4,c=o-l%a,p=o-(l/a|0),g=r(t,e,c*c+p*p);if(g)return g}u.clearRect(0,0,a,a);break}}var g,d,y,m,v,x=Object.keys(this.executorsByZIndex_).map(Number);for(x.sort(q),g=x.length-1;g>=0;--g){var S=x[g].toString();for(y=this.executorsByZIndex_[S],d=Te.length-1;d>=0;--d)if(void 0!==(m=y[f=Te[d]])&&(v=m.executeHitDetection(u,h,i,p,c)))return v}},t.prototype.getClipCoords=function(t){var e=this.maxExtent_;if(!e)return null;var i=e[0],n=e[1],o=e[2],r=e[3],s=[i,n,i,r,o,r,o,n];return U(s,0,8,2,t,s),s},t.prototype.isEmpty=function(){return Q(this.executorsByZIndex_)},t.prototype.execute=function(t,e,i,n,o,r,s){var a=Object.keys(this.executorsByZIndex_).map(Number);a.sort(q),this.maxExtent_&&(t.save(),this.clip(t,i));var h,l,c,u,f,_,p=r||Te;for(s&&a.reverse(),h=0,l=a.length;h<l;++h){var g=a[h].toString();for(f=this.executorsByZIndex_[g],c=0,u=p.length;c<u;++c){void 0!==(_=f[p[c]])&&_.execute(t,e,i,n,o,s)}}this.maxExtent_&&t.restore()},t}(),Le={};var we=Oe,Ce=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ke=function(t){function e(e,i,n,o,r,s,a){var h=t.call(this)||this;return h.context_=e,h.pixelRatio_=i,h.extent_=n,h.transform_=o,h.viewRotation_=r,h.squaredTolerance_=s,h.userTransform_=a,h.contextFillState_=null,h.contextStrokeState_=null,h.contextTextState_=null,h.fillState_=null,h.strokeState_=null,h.image_=null,h.imageAnchorX_=0,h.imageAnchorY_=0,h.imageHeight_=0,h.imageOpacity_=0,h.imageOriginX_=0,h.imageOriginY_=0,h.imageRotateWithView_=!1,h.imageRotation_=0,h.imageScale_=[0,0],h.imageWidth_=0,h.text_="",h.textOffsetX_=0,h.textOffsetY_=0,h.textRotateWithView_=!1,h.textRotation_=0,h.textScale_=[0,0],h.textFillState_=null,h.textStrokeState_=null,h.textState_=null,h.pixelCoordinates_=[],h.tmpLocalTransform_=Y(),h}return Ce(e,t),e.prototype.drawImages_=function(t,e,i,n){if(this.image_){var o=U(t,e,i,n,this.transform_,this.pixelCoordinates_),r=this.context_,s=this.tmpLocalTransform_,a=r.globalAlpha;1!=this.imageOpacity_&&(r.globalAlpha=a*this.imageOpacity_);var h=this.imageRotation_;this.imageRotateWithView_&&(h+=this.viewRotation_);for(var l=0,c=o.length;l<c;l+=2){var u=o[l]-this.imageAnchorX_,f=o[l+1]-this.imageAnchorY_;if(0!==h||1!=this.imageScale_[0]||1!=this.imageScale_[1]){var _=u+this.imageAnchorX_,p=f+this.imageAnchorY_;X(s,_,p,1,1,h,-_,-p),r.setTransform.apply(r,s),r.translate(_,p),r.scale(this.imageScale_[0],this.imageScale_[1]),r.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),r.setTransform(1,0,0,1,0,0)}else r.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,u,f,this.imageWidth_,this.imageHeight_)}1!=this.imageOpacity_&&(r.globalAlpha=a)}},e.prototype.drawText_=function(t,e,i,n){if(this.textState_&&""!==this.text_){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var o=U(t,e,i,n,this.transform_,this.pixelCoordinates_),r=this.context_,s=this.textRotation_;for(this.textRotateWithView_&&(s+=this.viewRotation_);e<i;e+=n){var a=o[e]+this.textOffsetX_,h=o[e+1]+this.textOffsetY_;if(0!==s||1!=this.textScale_[0]||1!=this.textScale_[1]){var l=X(this.tmpLocalTransform_,a,h,1,1,s,-a,-h);r.setTransform.apply(r,l),r.translate(a,h),r.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&r.strokeText(this.text_,0,0),this.textFillState_&&r.fillText(this.text_,0,0),r.setTransform(1,0,0,1,0,0)}else this.textStrokeState_&&r.strokeText(this.text_,a,h),this.textFillState_&&r.fillText(this.text_,a,h)}}},e.prototype.moveToLineTo_=function(t,e,i,n,o){var r=this.context_,s=U(t,e,i,n,this.transform_,this.pixelCoordinates_);r.moveTo(s[0],s[1]);var a=s.length;o&&(a-=2);for(var h=2;h<a;h+=2)r.lineTo(s[h],s[h+1]);return o&&r.closePath(),i},e.prototype.drawRings_=function(t,e,i,n){for(var o=0,r=i.length;o<r;++o)e=this.moveToLineTo_(t,e,i[o],n,!0);return e},e.prototype.drawCircle=function(t){if(E(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=$(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],n=e[3]-e[1],o=Math.sqrt(i*i+n*n),r=this.context_;r.beginPath(),r.arc(e[0],e[1],o,0,2*Math.PI),this.fillState_&&r.fill(),this.strokeState_&&r.stroke()}""!==this.text_&&this.drawText_(t.getCenter(),0,2,2)}},e.prototype.setStyle=function(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())},e.prototype.setTransform=function(t){this.transform_=t},e.prototype.drawGeometry=function(t){switch(t.getType()){case u.POINT:this.drawPoint(t);break;case u.LINE_STRING:this.drawLineString(t);break;case u.POLYGON:this.drawPolygon(t);break;case u.MULTI_POINT:this.drawMultiPoint(t);break;case u.MULTI_LINE_STRING:this.drawMultiLineString(t);break;case u.MULTI_POLYGON:this.drawMultiPolygon(t);break;case u.GEOMETRY_COLLECTION:this.drawGeometryCollection(t);break;case u.CIRCLE:this.drawCircle(t)}},e.prototype.drawFeature=function(t,e){var i=e.getGeometryFunction()(t);i&&E(this.extent_,i.getExtent())&&(this.setStyle(e),this.drawGeometry(i))},e.prototype.drawGeometryCollection=function(t){for(var e=t.getGeometriesArray(),i=0,n=e.length;i<n;++i)this.drawGeometry(e[i])},e.prototype.drawPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)},e.prototype.drawMultiPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)},e.prototype.drawLineString=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),E(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(""!==this.text_){var n=t.getFlatMidpoint();this.drawText_(n,0,2,2)}}},e.prototype.drawMultiLineString=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getExtent();if(E(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var i=this.context_,n=t.getFlatCoordinates(),o=0,r=t.getEnds(),s=t.getStride();i.beginPath();for(var a=0,h=r.length;a<h;++a)o=this.moveToLineTo_(n,o,r[a],s,!1);i.stroke()}if(""!==this.text_){var l=t.getFlatMidpoints();this.drawText_(l,0,l.length,2)}}},e.prototype.drawPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),E(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){var i=t.getFlatInteriorPoint();this.drawText_(i,0,2,2)}}},e.prototype.drawMultiPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),E(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_,i=t.getOrientedFlatCoordinates(),n=0,o=t.getEndss(),r=t.getStride();e.beginPath();for(var s=0,a=o.length;s<a;++s){var h=o[s];n=this.drawRings_(i,n,h,r)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){var l=t.getFlatInteriorPoints();this.drawText_(l,0,l.length,2)}}},e.prototype.setContextFillState_=function(t){var e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})},e.prototype.setContextStrokeState_=function(t){var e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),e.setLineDash&&(L(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset)),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})},e.prototype.setContextTextState_=function(t){var e=this.context_,i=this.contextTextState_,n=t.textAlign?t.textAlign:R;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=n&&(i.textAlign=n,e.textAlign=n),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=n,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:n,textBaseline:t.textBaseline})},e.prototype.setFillStrokeStyle=function(t,e){var i=this;if(t){var n=t.getColor();this.fillState_={fillStyle:kt(n||s)}}else this.fillState_=null;if(e){var o=e.getColor(),r=e.getLineCap(),u=e.getLineDash(),f=e.getLineDashOffset(),_=e.getLineJoin(),p=e.getWidth(),g=e.getMiterLimit(),d=u||T;this.strokeState_={lineCap:void 0!==r?r:I,lineDash:1===this.pixelRatio_?d:d.map((function(t){return t*i.pixelRatio_})),lineDashOffset:(f||O)*this.pixelRatio_,lineJoin:void 0!==_?_:a,lineWidth:(void 0!==p?p:l)*this.pixelRatio_,miterLimit:void 0!==g?g:c,strokeStyle:kt(o||h)}}else this.strokeState_=null},e.prototype.setImageStyle=function(t){var e;if(t&&(e=t.getSize())){var i=t.getAnchor(),n=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=i[0]*this.pixelRatio_,this.imageAnchorY_=i[1]*this.pixelRatio_,this.imageHeight_=e[1]*this.pixelRatio_,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=n[0],this.imageOriginY_=n[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation(),this.imageScale_=t.getScaleArray(),this.imageWidth_=e[0]*this.pixelRatio_}else this.image_=null},e.prototype.setTextStyle=function(t){if(t){var e=t.getFill();if(e){var i=e.getColor();this.textFillState_={fillStyle:kt(i||s)}}else this.textFillState_=null;var n=t.getStroke();if(n){var o=n.getColor(),r=n.getLineCap(),u=n.getLineDash(),f=n.getLineDashOffset(),_=n.getLineJoin(),p=n.getWidth(),g=n.getMiterLimit();this.textStrokeState_={lineCap:void 0!==r?r:I,lineDash:u||T,lineDashOffset:f||O,lineJoin:void 0!==_?_:a,lineWidth:void 0!==p?p:l,miterLimit:void 0!==g?g:c,strokeStyle:kt(o||h)}}else this.textStrokeState_=null;var d=t.getFont(),y=t.getOffsetX(),m=t.getOffsetY(),v=t.getRotateWithView(),x=t.getRotation(),S=t.getScaleArray(),L=t.getText(),w=t.getTextAlign(),C=t.getTextBaseline();this.textState_={font:void 0!==d?d:b,textAlign:void 0!==w?w:R,textBaseline:void 0!==C?C:M},this.text_=void 0!==L?L:"",this.textOffsetX_=void 0!==y?this.pixelRatio_*y:0,this.textOffsetY_=void 0!==m?this.pixelRatio_*m:0,this.textRotateWithView_=void 0!==v&&v,this.textRotation_=void 0!==x?x:0,this.textScale_=[this.pixelRatio_*S[0],this.pixelRatio_*S[1]]}else this.text_=""},e}(qt),Ee="fraction",De="pixels",Re="bottom-left",Me="bottom-right",be="top-left",Fe="top-right",Ae=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Pe=null,We=function(t){function e(e,i,n,o,r,s){var a=t.call(this)||this;return a.hitDetectionImage_=null,a.image_=e||new Image,null!==o&&(a.image_.crossOrigin=o),a.canvas_={},a.color_=s,a.unlisten_=null,a.imageState_=r,a.size_=n,a.src_=i,a.tainted_,a}return Ae(e,t),e.prototype.isTainted_=function(){if(void 0===this.tainted_&&this.imageState_===o.LOADED){Pe||(Pe=n(1,1)),Pe.drawImage(this.image_,0,0);try{Pe.getImageData(0,0,1,1),this.tainted_=!1}catch(t){Pe=null,this.tainted_=!0}}return!0===this.tainted_},e.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(tt.CHANGE)},e.prototype.handleImageError_=function(){this.imageState_=o.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()},e.prototype.handleImageLoad_=function(){this.imageState_=o.LOADED,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()},e.prototype.getImage=function(t){return this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_},e.prototype.getPixelRatio=function(t){return this.replaceColor_(t),this.canvas_[t]?t:1},e.prototype.getImageState=function(){return this.imageState_},e.prototype.getHitDetectionImage=function(){if(!this.hitDetectionImage_)if(this.isTainted_()){var t=this.size_[0],e=this.size_[1],i=n(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},e.prototype.getSize=function(){return this.size_},e.prototype.getSrc=function(){return this.src_},e.prototype.load=function(){if(this.imageState_==o.IDLE){this.imageState_=o.LOADING;try{this.image_.src=this.src_}catch(t){this.handleImageError_()}this.unlisten_=et(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}},e.prototype.replaceColor_=function(t){if(this.color_&&!this.canvas_[t]){var e=document.createElement("canvas");this.canvas_[t]=e,e.width=Math.ceil(this.image_.width*t),e.height=Math.ceil(this.image_.height*t);var i=e.getContext("2d");if(i.scale(t,t),i.drawImage(this.image_,0,0),i.globalCompositeOperation="multiply","multiply"===i.globalCompositeOperation||this.isTainted_())i.fillStyle=it(this.color_),i.fillRect(0,0,e.width/t,e.height/t),i.globalCompositeOperation="destination-in",i.drawImage(this.image_,0,0);else{for(var n=i.getImageData(0,0,e.width,e.height),o=n.data,r=this.color_[0]/255,s=this.color_[1]/255,a=this.color_[2]/255,h=this.color_[3],l=0,c=o.length;l<c;l+=4)o[l]*=r,o[l+1]*=s,o[l+2]*=a,o[l+3]*=h;i.putImageData(n,0,0)}}},e.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},e}(nt);var Ye=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ge=function(t){function e(e){var i=this,n=e||{},s=void 0!==n.opacity?n.opacity:1,a=void 0!==n.rotation?n.rotation:0,h=void 0!==n.scale?n.scale:1,l=void 0!==n.rotateWithView&&n.rotateWithView;(i=t.call(this,{opacity:s,rotation:a,scale:h,displacement:void 0!==n.displacement?n.displacement:[0,0],rotateWithView:l})||this).anchor_=void 0!==n.anchor?n.anchor:[.5,.5],i.normalizedAnchor_=null,i.anchorOrigin_=void 0!==n.anchorOrigin?n.anchorOrigin:be,i.anchorXUnits_=void 0!==n.anchorXUnits?n.anchorXUnits:Ee,i.anchorYUnits_=void 0!==n.anchorYUnits?n.anchorYUnits:Ee,i.crossOrigin_=void 0!==n.crossOrigin?n.crossOrigin:null;var c=void 0!==n.img?n.img:null,u=void 0!==n.imgSize?n.imgSize:null,_=n.src;f(!(void 0!==_&&c),4),f(!c||c&&u,5),void 0!==_&&0!==_.length||!c||(_=c.src||A(c)),f(void 0!==_&&_.length>0,6);var p=void 0!==n.src?o.IDLE:o.LOADED;return i.color_=void 0!==n.color?r(n.color):null,i.iconImage_=function(t,e,i,n,o,r){var s=ot.get(e,n,r);return s||(s=new We(t,e,i,n,o,r),ot.set(e,n,r,s)),s}(c,_,u,i.crossOrigin_,p,i.color_),i.offset_=void 0!==n.offset?n.offset:[0,0],i.offsetOrigin_=void 0!==n.offsetOrigin?n.offsetOrigin:be,i.origin_=null,i.size_=void 0!==n.size?n.size:null,i}return Ye(e,t),e.prototype.clone=function(){var t=this.getScale();return new e({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,crossOrigin:this.crossOrigin_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,src:this.getSrc(),offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,size:null!==this.size_?this.size_.slice():void 0,opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})},e.prototype.getAnchor=function(){if(this.normalizedAnchor_)return this.normalizedAnchor_;var t=this.anchor_,e=this.getSize();if(this.anchorXUnits_==Ee||this.anchorYUnits_==Ee){if(!e)return null;t=this.anchor_.slice(),this.anchorXUnits_==Ee&&(t[0]*=e[0]),this.anchorYUnits_==Ee&&(t[1]*=e[1])}if(this.anchorOrigin_!=be){if(!e)return null;t===this.anchor_&&(t=this.anchor_.slice()),this.anchorOrigin_!=Fe&&this.anchorOrigin_!=Me||(t[0]=-t[0]+e[0]),this.anchorOrigin_!=Re&&this.anchorOrigin_!=Me||(t[1]=-t[1]+e[1])}var i=this.getDisplacement();return t[0]-=i[0],t[1]+=i[1],this.normalizedAnchor_=t,this.normalizedAnchor_},e.prototype.setAnchor=function(t){this.anchor_=t,this.normalizedAnchor_=null},e.prototype.getColor=function(){return this.color_},e.prototype.getImage=function(t){return this.iconImage_.getImage(t)},e.prototype.getPixelRatio=function(t){return this.iconImage_.getPixelRatio(t)},e.prototype.getImageSize=function(){return this.iconImage_.getSize()},e.prototype.getImageState=function(){return this.iconImage_.getImageState()},e.prototype.getHitDetectionImage=function(){return this.iconImage_.getHitDetectionImage()},e.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var t=this.offset_;if(this.offsetOrigin_!=be){var e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice(),this.offsetOrigin_!=Fe&&this.offsetOrigin_!=Me||(t[0]=i[0]-e[0]-t[0]),this.offsetOrigin_!=Re&&this.offsetOrigin_!=Me||(t[1]=i[1]-e[1]-t[1])}return this.origin_=t,this.origin_},e.prototype.getSrc=function(){return this.iconImage_.getSrc()},e.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},e.prototype.listenImageChange=function(t){this.iconImage_.addEventListener(tt.CHANGE,t)},e.prototype.load=function(){this.iconImage_.load()},e.prototype.unlistenImageChange=function(t){this.iconImage_.removeEventListener(tt.CHANGE,t)},e}(Ct),Ne=.5;function Be(t,e,i,o,r,s,a){var h=.5*t[0],l=.5*t[1],c=n(h,l);c.imageSmoothingEnabled=!1;for(var f=c.canvas,_=new ke(c,.5,r,null,a),p=i.length,g=Math.floor(16777215/p),d={},y=1;y<=p;++y){var m=i[y-1],v=m.getStyleFunction()||o;if(o){var x=v(m,s);if(x){Array.isArray(x)||(x=[x]);for(var S="#"+("000000"+(y*g).toString(16)).slice(-6),I=0,T=x.length;I<T;++I){var O=x[I],L=O.getGeometryFunction()(m);if(L&&E(r,L.getExtent())){var w=O.clone(),C=w.getFill();C&&C.setColor(S);var k=w.getStroke();k&&(k.setColor(S),k.setLineDash(null)),w.setText(void 0);var D=O.getImage();if(D&&0!==D.getOpacity()){var R=D.getImageSize();if(!R)continue;var M=n(R[0],R[1],void 0,{alpha:!1}),b=M.canvas;M.fillStyle=S,M.fillRect(0,0,b.width,b.height),w.setImage(new Ge({img:b,imgSize:R,anchor:D.getAnchor(),anchorXUnits:De,anchorYUnits:De,offset:D.getOrigin(),opacity:1,size:D.getSize(),scale:D.getScale(),rotation:D.getRotation(),rotateWithView:D.getRotateWithView()}))}var F=w.getZIndex()||0;(W=d[F])||(W={},d[F]=W,W[u.POLYGON]=[],W[u.CIRCLE]=[],W[u.LINE_STRING]=[],W[u.POINT]=[]),W[L.getType().replace("Multi","")].push(L,w)}}}}}for(var A=Object.keys(d).map(Number).sort(q),P=(y=0,A.length);y<P;++y){var W=d[A[y]];for(var Y in W){var G=W[Y];for(I=0,T=G.length;I<T;I+=2){_.setStyle(G[I+1]);for(var N=0,B=e.length;N<B;++N)_.setTransform(e[N]),_.drawGeometry(G[I])}}}return c.getImageData(0,0,f.width,f.height)}function Xe(t,e,i){var n=[];if(i){var o=Math.floor(.5*Math.round(t[0])),r=Math.floor(.5*Math.round(t[1])),s=4*(rt(o,0,i.width-1)+rt(r,0,i.height-1)*i.width),a=i.data[s],h=i.data[s+1],l=i.data[s+2]+256*(h+256*a),c=Math.floor(16777215/e.length);l&&l%c==0&&n.push(e[l/c-1])}return n}var ze={Point:function(t,e,i,n,r){var s,a=i.getImage(),h=i.getText();r&&(t=r,s=a&&h&&h.getText()?{}:void 0);if(a){if(a.getImageState()!=o.LOADED)return;var l=t.getBuilder(i.getZIndex(),fe.IMAGE);l.setImageStyle(a,s),l.drawPoint(e,n)}if(h&&h.getText()){var c=t.getBuilder(i.getZIndex(),fe.TEXT);c.setTextStyle(h,s),c.drawText(e,n)}},LineString:function(t,e,i,n,o){var r=i.getStroke();if(r){var s=t.getBuilder(i.getZIndex(),fe.LINE_STRING);s.setFillStrokeStyle(null,r),s.drawLineString(e,n)}var a=i.getText();if(a&&a.getText()){var h=(o||t).getBuilder(i.getZIndex(),fe.TEXT);h.setTextStyle(a),h.drawText(e,n)}},Polygon:function(t,e,i,n,o){var r=i.getFill(),s=i.getStroke();if(r||s){var a=t.getBuilder(i.getZIndex(),fe.POLYGON);a.setFillStrokeStyle(r,s),a.drawPolygon(e,n)}var h=i.getText();if(h&&h.getText()){var l=(o||t).getBuilder(i.getZIndex(),fe.TEXT);l.setTextStyle(h),l.drawText(e,n)}},MultiPoint:function(t,e,i,n,r){var s,a=i.getImage(),h=i.getText();r&&(t=r,s=a&&h&&h.getText()?{}:void 0);if(a){if(a.getImageState()!=o.LOADED)return;var l=t.getBuilder(i.getZIndex(),fe.IMAGE);l.setImageStyle(a,s),l.drawMultiPoint(e,n)}if(h&&h.getText()){var c=(r||t).getBuilder(i.getZIndex(),fe.TEXT);c.setTextStyle(h,s),c.drawText(e,n)}},MultiLineString:function(t,e,i,n,o){var r=i.getStroke();if(r){var s=t.getBuilder(i.getZIndex(),fe.LINE_STRING);s.setFillStrokeStyle(null,r),s.drawMultiLineString(e,n)}var a=i.getText();if(a&&a.getText()){var h=(o||t).getBuilder(i.getZIndex(),fe.TEXT);h.setTextStyle(a),h.drawText(e,n)}},MultiPolygon:function(t,e,i,n,o){var r=i.getFill(),s=i.getStroke();if(s||r){var a=t.getBuilder(i.getZIndex(),fe.POLYGON);a.setFillStrokeStyle(r,s),a.drawMultiPolygon(e,n)}var h=i.getText();if(h&&h.getText()){var l=(o||t).getBuilder(i.getZIndex(),fe.TEXT);l.setTextStyle(h),l.drawText(e,n)}},GeometryCollection:function(t,e,i,n,o){var r,s,a=e.getGeometriesArray();for(r=0,s=a.length;r<s;++r){(0,ze[a[r].getType()])(t,a[r],i,n,o)}},Circle:function(t,e,i,n,o){var r=i.getFill(),s=i.getStroke();if(r||s){var a=t.getBuilder(i.getZIndex(),fe.CIRCLE);a.setFillStrokeStyle(r,s),a.drawCircle(e,n)}var h=i.getText();if(h&&h.getText()){var l=(o||t).getBuilder(i.getZIndex(),fe.TEXT);l.setTextStyle(h),l.drawText(e,n)}}};function Je(t,e){return parseInt(A(t),10)-parseInt(A(e),10)}function Ve(t,e){var i=Ue(t,e);return i*i}function Ue(t,e){return.5*t/e}function je(t,e,i,n,r,s,a){var h=!1,l=i.getImage();if(l){var c=l.getImageState();c==o.LOADED||c==o.ERROR?l.unlistenImageChange(r):(c==o.IDLE&&l.load(),c=l.getImageState(),l.listenImageChange(r),h=!0)}return function(t,e,i,n,o,r){var s=i.getGeometryFunction()(e);if(!s)return;var a=s.simplifyTransformed(n,o);if(i.getRenderer())He(t,a,i,e);else{(0,ze[a.getType()])(t,a,i,e,r)}}(t,e,i,n,s,a),h}function He(t,e,i,n){if(e.getType()!=u.GEOMETRY_COLLECTION)t.getBuilder(i.getZIndex(),fe.DEFAULT).drawCustom(e,n,i.getRenderer());else for(var o=e.getGeometries(),r=0,s=o.length;r<s;++r)He(t,o[r],i,n)}function Ze(t,e,i,n,o,r,s){var a=new XMLHttpRequest;a.open("GET","function"==typeof t?t(i,n,o):t,!0),e.getType()==at.ARRAY_BUFFER&&(a.responseType="arraybuffer"),a.withCredentials=false,a.onload=function(t){if(!a.status||a.status>=200&&a.status<300){var n=e.getType(),h=void 0;n==at.JSON||n==at.TEXT?h=a.responseText:n==at.XML?(h=a.responseXML)||(h=(new DOMParser).parseFromString(a.responseText,"application/xml")):n==at.ARRAY_BUFFER&&(h=a.response),h?r(e.readFeatures(h,{extent:i,featureProjection:o}),e.readProjection(h)):s()}else s()},a.onerror=s,a.send()}function Ke(t,e){return function(i,n,o,r,s){var a=this;Ze(t,e,i,n,o,(function(t,e){a.addFeatures(t),void 0!==r&&r(t)}),s||st)}}export{Jt as B,ue as C,Ft as F,Ne as H,Ge as I,fe as R,Bt as S,se as T,At as a,at as b,Be as c,we as d,ht as e,bt as f,Ve as g,Xe as h,Ue as i,Je as j,_t as k,Ze as l,Gt as m,ke as n,je as r,Ke as x};
